📚 文档内容概览
这份文档全面解析了Covasim的病毒传播机制，包含以下15个主要部分：
1. 传播机制概述
● 基于个体的（Agent-Based）传播模型
● 传播的三个核心要素：传染源、目标、接触网络
● 每个时间步的传播流程（完整流程图）
2. 核心传播公式
● 传播概率的完整数学表达
● 各因子含义一览表（12个因子）
● compute_trans_sus() 源码解析
3. 个体传染性（rel_trans）的初始化
● ✅ set_prognoses() - 基于年龄和分布设定初始传染性
● ✅ trans_ORs - 年龄相关传染性比值比
● ✅ beta_dist - 负二项分布产生超级传播者效应
● ✅ 突破性感染对传染性的影响（trans_redux=0.59）
4. 病毒载量（Viral Load）机制（核心！）
● 📊 compute_viral_load() - 时变传染性调节因子
● 📊 高载量阶段与低载量阶段的两阶段模型
● 📊 载量归一化机制（平均载量=1.0）
● 📊 不同传染期长度下的载量对比表
● 📊 时间演变可视化图
5. 传播概率的完整计算
● 传染性因子的组合（f_asymp, f_iso, f_quar）
● 易感性因子的组合（rel_sus, sus_imm）
● 最终传播概率的计算
6. 感染判定过程
● 接触网络结构（random/hybrid/synthpops）
● 接触对的遍历机制
● 双向传播
● 伯努利试验判定
7. 感染后处理（infect函数）
● infect() 完整流程图
● 关键时间线确定（所有对数正态分布参数）
● 预后概率的确定（受免疫、变种、医疗资源影响）
8. 变种病毒对传播的影响
● 5个预定义变种的传播参数对比
● 变种对疾病严重程度的影响
● 变种间的传播竞争机制
9. 免疫对传播的影响
● 免疫降低易感性和传染性的两条路径
● 免疫保护因子的计算流程
● 免疫对传播链的完整影响图
10. 完整示例（6个实用示例）
● ✅ 示例1：观察传播过程
● ✅ 示例2：比较不同beta值的传播效果
● ✅ 示例3：观察病毒载量的影响
● ✅ 示例4：追踪个体传播链
● ✅ 示例5：自定义个体传染性分布
● ✅ 示例6：自定义传播追踪分析器
11. 参数详解（9大类参数）
● 基础传播参数（beta, asymp_factor, trans_redux）
● 个体传染性分布参数（beta_dist）
● 病毒载量参数（viral_dist）
● 接触层参数（contacts, beta_layer）
● 隔离和检疫参数（iso_factor, quar_factor）
● 疾病进展时间参数（dur_*）
● 年龄相关预后参数（完整10年龄组对照表）
● 变种传播参数（5个变种对比表）
● 医疗资源参数（n_beds_hosp, n_beds_icu）
12. 常见问题（7个FAQ）
● Q1: beta值如何影响传播？
● Q2: 病毒载量是实际的病毒拷贝数吗？
● Q3: 为什么有些人传染了很多人？（超级传播者）
● Q4: 如何修改特定接触层的传播率？
● Q5: 突破性感染的传染性降低只发生一次吗？
● Q6: 感染后的预后是什么时候决定的？
● Q7: 如何查看传播日志？
13. 最佳实践
● ✅ 推荐做法（5条）
● ❌ 应避免的做法（4条）
14. 总结
● 核心要点回顾（5大要点）
● 关键函数速查表（8个核心函数）
● 传播公式总结框图
15. 参考资源
● 科学文献引用（7篇）
● Covasim源代码位置
● 关键参数位置索引
🎯 核心知识点
传播概率的完整公式
P(i→j) = β × rel_beta × rel_beta_variant
         × rel_trans(i) × inf(i) × viral_load(i)
         × f_asymp(i) × f_iso(i) × f_quar(i)
         × beta_layer
         × rel_sus(j) × sus(j) × f_quar(j)
         × (1 - sus_imm(j))
         × layer_beta(i,j)

然后: if random() < P(i→j) → 发生感染
病毒载量的两阶段模型
传染性
 ↑
 │ ┌──────────┐
1.538 │ 高载量阶段 │ (前30%时间，最多4天)
 │ └──────────┬──────────────────┐
0.769          │  低载量阶段       │ (后70%时间)
 └─────────────┴──────────────────┴──→ 时间
个体传染性的超级传播者效应
rel_trans = trans_ORs(age) × NegBinomial(mean=1.0, k=0.45)
→ 大多数人传染性较低，少数人传染性很高
💡 实用示例代码
文档中包含了6个可以直接运行的完整示例：
1. 基本传播观察 - 创建模拟并查看传播结果
2. beta值对比 - 比较不同传播率的效果
3. 病毒载量影响 - 对比不同viral_dist参数
4. 传播链追踪 - 查看传播日志和个体故事
5. 超级传播者 - 自定义传染性分布
6. 传播追踪器 - 自定义分析器追踪传播动态
📊 可视化图表
文档包含多个可视化内容：
● 每日传播流程图（sim.step()）
● 病毒载量时间演变图
● 负二项分布特性图
● infect()函数完整流程图
● 免疫对传播的影响链图
● 传播公式总结框图
🔗 相关文档
现在你有三份完整的指南：
1. 人员免疫机制.md - 免疫系统的工作原理
2. 健康状态转换.md - 健康状态转换详解
3. 病毒传播机制.md - 病毒传播机制详解（本文档）
这三份文档涵盖了 Covasim 的核心机制！
如果你需要更多具体的示例或有任何问题，随时告诉我！🎉
