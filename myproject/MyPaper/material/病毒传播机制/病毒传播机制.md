# Covasim ç—…æ¯’ä¼ æ’­æœºåˆ¶è¯¦è§£

## ğŸ“– ç›®å½•

1. [ä¼ æ’­æœºåˆ¶æ¦‚è¿°](#1-ä¼ æ’­æœºåˆ¶æ¦‚è¿°)
2. [æ ¸å¿ƒä¼ æ’­å…¬å¼](#2-æ ¸å¿ƒä¼ æ’­å…¬å¼)
3. [ä¸ªä½“ä¼ æŸ“æ€§ï¼ˆrel_transï¼‰çš„åˆå§‹åŒ–](#3-ä¸ªä½“ä¼ æŸ“æ€§rel_transçš„åˆå§‹åŒ–)
4. [ç—…æ¯’è½½é‡ï¼ˆViral Loadï¼‰æœºåˆ¶](#4-ç—…æ¯’è½½é‡viral-loadæœºåˆ¶)
5. [ä¼ æ’­æ¦‚ç‡çš„å®Œæ•´è®¡ç®—](#5-ä¼ æ’­æ¦‚ç‡çš„å®Œæ•´è®¡ç®—)
6. [æ„ŸæŸ“åˆ¤å®šè¿‡ç¨‹](#6-æ„ŸæŸ“åˆ¤å®šè¿‡ç¨‹)
7. [æ„ŸæŸ“åå¤„ç†ï¼ˆinfectå‡½æ•°ï¼‰](#7-æ„ŸæŸ“åå¤„ç†infectå‡½æ•°)
8. [å˜ç§ç—…æ¯’å¯¹ä¼ æ’­çš„å½±å“](#8-å˜ç§ç—…æ¯’å¯¹ä¼ æ’­çš„å½±å“)
9. [å…ç–«å¯¹ä¼ æ’­çš„å½±å“](#9-å…ç–«å¯¹ä¼ æ’­çš„å½±å“)
10. [å®Œæ•´ç¤ºä¾‹](#10-å®Œæ•´ç¤ºä¾‹)
11. [å‚æ•°è¯¦è§£](#11-å‚æ•°è¯¦è§£)
12. [å¸¸è§é—®é¢˜](#12-å¸¸è§é—®é¢˜)
13. [æœ€ä½³å®è·µ](#13-æœ€ä½³å®è·µ)
14. [æ€»ç»“](#14-æ€»ç»“)
15. [å‚è€ƒèµ„æº](#15-å‚è€ƒèµ„æº)

---

## 1. ä¼ æ’­æœºåˆ¶æ¦‚è¿°

### 1.1 Covasim ä¼ æ’­æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³

Covasim ä½¿ç”¨åŸºäºä¸ªä½“çš„ï¼ˆAgent-Basedï¼‰ä¼ æ’­æ¨¡å‹ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

> æ¯ä¸ªæ—¶é—´æ­¥ï¼ˆå¤©ï¼‰ï¼Œå¯¹æ¯å¯¹æœ‰æ¥è§¦å…³ç³»çš„äººï¼Œè®¡ç®—ä¼ æ’­æ¦‚ç‡ï¼Œç„¶åé€šè¿‡ä¼¯åŠªåˆ©è¯•éªŒå†³å®šæ˜¯å¦å‘ç”Ÿæ„ŸæŸ“ã€‚

```
ä¼ æ’­æ¦‚ç‡ = Î² Ã— ä¼ æŸ“æºçš„ç›¸å¯¹ä¼ æŸ“æ€§(rel_trans) Ã— ç›®æ ‡çš„ç›¸å¯¹æ˜“æ„Ÿæ€§(rel_sus) Ã— æ¥è§¦å±‚æƒé‡(layer_beta)
```

### 1.2 ä¼ æ’­çš„ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ 

1. **ä¼ æŸ“æºï¼ˆSourceï¼‰**ï¼šå·²æ„ŸæŸ“ä¸”å¤„äºä¼ æŸ“æœŸçš„ä¸ªä½“
   - å…¶ä¼ æŸ“èƒ½åŠ›ç”± `rel_trans Ã— viral_load Ã— å„ç§ä¿®æ­£å› å­` å†³å®š
2. **ç›®æ ‡ï¼ˆTargetï¼‰**ï¼šæ˜“æ„Ÿä¸ªä½“
   - å…¶è¢«æ„ŸæŸ“çš„éš¾æ˜“ç¨‹åº¦ç”± `rel_sus Ã— å…ç–«ä¿æŠ¤ Ã— å„ç§ä¿®æ­£å› å­` å†³å®š
3. **æ¥è§¦ç½‘ç»œï¼ˆContact Networkï¼‰**ï¼šå†³å®šè°ä¸è°æœ‰æ¥è§¦
   - ä¸åŒæ¥è§¦å±‚ï¼ˆå®¶åº­ã€å­¦æ ¡ã€å·¥ä½œã€ç¤¾åŒºï¼‰æœ‰ä¸åŒçš„ä¼ æ’­æƒé‡

### 1.3 æ¯ä¸ªæ—¶é—´æ­¥çš„ä¼ æ’­æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    sim.step() æ¯æ—¥æµç¨‹                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. update_states_pre()    æ›´æ–°æ‰€æœ‰äººçš„å¥åº·çŠ¶æ€            â”‚
â”‚     â”œâ”€ check_infectious()  æš´éœ²è€… â†’ ä¼ æŸ“è€…                â”‚
â”‚     â”œâ”€ check_symptomatic() â†’ å‡ºç°ç—‡çŠ¶                     â”‚
â”‚     â”œâ”€ check_severe()      â†’ é‡ç—‡                        â”‚
â”‚     â”œâ”€ check_critical()    â†’ å±é‡                        â”‚
â”‚     â”œâ”€ check_recovery()    â†’ åº·å¤                        â”‚
â”‚     â”œâ”€ check_death()       â†’ æ­»äº¡                        â”‚
â”‚     â””â”€ check_immunity()    æ›´æ–°å…ç–«ä¿æŠ¤                   â”‚
â”‚                                                         â”‚
â”‚  2. update_contacts()      åˆ·æ–°åŠ¨æ€æ¥è§¦ç½‘ç»œ               â”‚
â”‚                                                         â”‚
â”‚  3. compute_viral_load()   è®¡ç®—æ‰€æœ‰äººçš„ç—…æ¯’è½½é‡           â”‚
â”‚                                                         â”‚
â”‚  4. å¯¹æ¯ä¸ªå˜ç§:                                          â”‚
â”‚     â”‚  å¯¹æ¯ä¸ªæ¥è§¦å±‚:                                      â”‚
â”‚     â”‚  â”œâ”€ compute_trans_sus()   è®¡ç®—ä¼ æŸ“æ€§å’Œæ˜“æ„Ÿæ€§         â”‚
â”‚     â”‚  â””â”€ compute_infections() ç¡®å®šè°æ„ŸæŸ“äº†è°             â”‚
â”‚     â”‚     â””â”€ people.infect()   æ‰§è¡Œæ„ŸæŸ“ã€ç¡®å®šé¢„å         â”‚
â”‚                                                         â”‚
â”‚  5. update_nab()           æ›´æ–°ä¸­å’ŒæŠ—ä½“æ°´å¹³               â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å¯¹åº”æºç ï¼ˆ`sim.py` `step()` æ–¹æ³•ï¼‰ï¼š

```python
# sim.py ç¬¬558-649è¡Œ
def step(self):
    # 1. æ›´æ–°çŠ¶æ€
    people.update_states_pre(t=t)
    contacts = people.update_contacts()

    # 2. è®¡ç®—ç—…æ¯’è½½é‡
    viral_load = cvu.compute_viral_load(t, date_inf, date_rec, date_dead,
                                         frac_time, load_ratio, high_cap)

    # 3. å¯¹æ¯ä¸ªå˜ç§ã€æ¯ä¸ªæ¥è§¦å±‚è®¡ç®—ä¼ æ’­
    for variant in range(nv):
        beta = self['beta'] * self['rel_beta'] * variant_pars['rel_beta']
        for lkey, layer in contacts.items():
            rel_trans, rel_sus = cvu.compute_trans_sus(...)
            source_inds, target_inds = cvu.compute_infections(beta, p1, p2, ...)
            people.infect(inds=target_inds, source=source_inds, ...)
```

---

## 2. æ ¸å¿ƒä¼ æ’­å…¬å¼

### 2.1 ä¼ æ’­æ¦‚ç‡çš„å®Œæ•´æ•°å­¦è¡¨è¾¾

å¯¹äºä¸€å¯¹æ¥è§¦ (iâ†’j)ï¼Œi æ˜¯ä¼ æŸ“æºï¼Œj æ˜¯ç›®æ ‡ï¼Œä¼ æ’­æ¦‚ç‡ä¸ºï¼š

```
P(iâ†’j) = Î²_total Ã— RelTrans(i) Ã— RelSus(j) Ã— layer_beta(i,j)
```

å…¶ä¸­å„é¡¹çš„è¯¦ç»†å±•å¼€ä¸ºï¼š

```
Î²_total = Î² Ã— rel_beta_global Ã— rel_beta_variant

RelTrans(i) = rel_trans(i) Ã— inf(i) Ã— viral_load(i) Ã— f_asymp(i) Ã— f_iso(i) Ã— f_quar(i)

RelSus(j) = rel_sus(j) Ã— sus(j) Ã— f_quar(j) Ã— (1 - sus_imm(j))
```

### 2.2 å„å› å­å«ä¹‰ä¸€è§ˆè¡¨

| å› å­ | å«ä¹‰ | å–å€¼èŒƒå›´ | æ¥æº |
|------|------|----------|------|
| `Î²` | åŸºç¡€ä¼ æ’­ç‡ | 0.016ï¼ˆé»˜è®¤ï¼‰ | æ ¡å‡†å€¼ |
| `rel_beta` | å…¨å±€ç›¸å¯¹ä¼ æ’­ç‡ | 1.0ï¼ˆé»˜è®¤ï¼‰ | ç”¨æˆ·è®¾ç½® |
| `rel_beta_variant` | å˜ç§ç›¸å¯¹ä¼ æ’­ç‡ | 1.0-2.2 | å˜ç§å‚æ•° |
| `rel_trans(i)` | ä¸ªä½“ç›¸å¯¹ä¼ æŸ“æ€§ | ä»åˆ†å¸ƒä¸­æŠ½å– | beta_dist |
| `inf(i)` | æ˜¯å¦å¤„äºä¼ æŸ“æœŸ | 0 æˆ– 1 | çŠ¶æ€åˆ¤æ–­ |
| `viral_load(i)` | æ—¶å˜ç—…æ¯’è½½é‡ | 0-æŸä¸ªå³°å€¼ | viral_dist |
| `f_asymp(i)` | æ— ç—‡çŠ¶å› å­ | asymp_factor æˆ– 1 | ç—‡çŠ¶çŠ¶æ€ |
| `f_iso(i)` | éš”ç¦»å› å­ | iso_factor æˆ– 1 | éš”ç¦»çŠ¶æ€ |
| `f_quar(i/j)` | éš”ç¦»å› å­ | quar_factor æˆ– 1 | éš”ç¦»çŠ¶æ€ |
| `rel_sus(j)` | ä¸ªä½“ç›¸å¯¹æ˜“æ„Ÿæ€§ | åŸºäºå¹´é¾„ | prognoses |
| `sus(j)` | æ˜¯å¦æ˜“æ„Ÿ | 0 æˆ– 1 | çŠ¶æ€åˆ¤æ–­ |
| `sus_imm(j)` | å…ç–«ä¿æŠ¤å› å­ | 0-1 | NAbæ°´å¹³ |
| `layer_beta(i,j)` | æ¥è§¦å±‚æƒé‡ | å±‚ç‰¹å®šå€¼ | layeré…ç½® |

å¯¹åº”æºç ï¼ˆ`utils.py` `compute_trans_sus`ï¼‰ï¼š

```python
# utils.py ç¬¬83-90è¡Œ
def compute_trans_sus(rel_trans, rel_sus, inf, sus, beta_layer,
                      viral_load, symp, iso, quar,
                      asymp_factor, iso_factor, quar_factor, immunity_factors):
    f_asymp   =  symp + ~symp * asymp_factor  # æ— ç—‡çŠ¶ä¼ æŸ“åŠ›è°ƒæ•´
    f_iso     = ~iso  +  iso  * iso_factor     # éš”ç¦»æ•ˆæœ
    f_quar    = ~quar +  quar * quar_factor    # éš”ç¦»æ•ˆæœ
    rel_trans = rel_trans * inf * f_quar * f_asymp * f_iso * beta_layer * viral_load
    rel_sus   = rel_sus * sus * f_quar * (1 - immunity_factors)
    return rel_trans, rel_sus
```

---

## 3. ä¸ªä½“ä¼ æŸ“æ€§ï¼ˆrel_transï¼‰çš„åˆå§‹åŒ–

### 3.1 åˆå§‹åŒ–è¿‡ç¨‹

æ¯ä¸ªäººçš„åŸºç¡€ä¼ æŸ“æ€§ `rel_trans` åœ¨äººç¾¤åˆå§‹åŒ–æ—¶è®¾å®šï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š

```
rel_trans = trans_ORs(age) Ã— sample(beta_dist)
```

å…¶ä¸­ï¼š
- `trans_ORs(age)`ï¼šåŸºäºå¹´é¾„çš„ä¼ æŸ“æ€§æ¯”å€¼æ¯”ï¼ˆOdds Ratioï¼‰
- `sample(beta_dist)`ï¼šä»è´ŸäºŒé¡¹åˆ†å¸ƒä¸­æŠ½å–çš„ä¸ªä½“å¼‚è´¨æ€§

å¯¹åº”æºç ï¼ˆ`people.py` `set_prognoses`ï¼‰ï¼š

```python
# people.py ç¬¬139-160è¡Œ
def set_prognoses(self):
    progs = pars['prognoses']
    inds = np.digitize(self.age, progs['age_cutoffs']) - 1
    self.rel_trans[:] = progs['trans_ORs'][inds] * cvu.sample(**self.pars['beta_dist'], size=len(inds))
```

### 3.2 å¹´é¾„ç›¸å…³ä¼ æŸ“æ€§ï¼ˆtrans_ORsï¼‰

åœ¨é»˜è®¤å‚æ•°ä¸­ï¼Œæ‰€æœ‰å¹´é¾„ç»„çš„ `trans_ORs` éƒ½æ˜¯ 1.0ï¼Œå³ä¸åŒå¹´é¾„çš„ä¼ æŸ“æ€§æ²¡æœ‰å·®å¼‚ï¼š

| å¹´é¾„ç»„ | 0-9 | 10-19 | 20-29 | 30-39 | 40-49 | 50-59 | 60-69 | 70-79 | 80-89 | 90+ |
|--------|-----|-------|-------|-------|-------|-------|-------|-------|-------|-----|
| trans_ORs | 1.00 | 1.00 | 1.00 | 1.00 | 1.00 | 1.00 | 1.00 | 1.00 | 1.00 | 1.00 |

å¯¹åº”æºç ï¼ˆ`parameters.py` `get_prognoses`ï¼‰ï¼š

```python
# parameters.py ç¬¬258è¡Œ
trans_ORs = np.array([1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 1.00])
```

> ğŸ’¡ **æ³¨æ„**ï¼šè™½ç„¶é»˜è®¤ä¸åŒºåˆ†å¹´é¾„ï¼Œä½†ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ä¸åŒå¹´é¾„ç»„çš„ä¼ æŸ“æ€§ã€‚

### 3.3 ä¸ªä½“ä¼ æŸ“æ€§åˆ†å¸ƒï¼ˆbeta_distï¼‰

ä¸ªä½“ä¼ æŸ“æ€§çš„å¼‚è´¨æ€§é€šè¿‡**è´ŸäºŒé¡¹åˆ†å¸ƒï¼ˆNegative Binomialï¼‰**æ¥å®ç°ï¼š

é»˜è®¤å‚æ•°ï¼š

```python
beta_dist = {
    'dist': 'neg_binomial',  # åˆ†å¸ƒç±»å‹
    'par1': 1.0,             # å‡å€¼ï¼ˆmeanï¼‰
    'par2': 0.45,            # ç¦»æ•£å‚æ•°ï¼ˆdispersion, kï¼‰
    'step': 0.01             # æ­¥é•¿ï¼ˆç”¨äºäº§ç”Ÿéæ•´æ•°è¾“å‡ºï¼‰
}
```

**è´ŸäºŒé¡¹åˆ†å¸ƒçš„ç‰¹ç‚¹**ï¼š
- å‡å€¼ = par1 = 1.0ï¼Œè¡¨ç¤ºå¹³å‡ä¼ æŸ“æ€§ä¸º 1
- ç¦»æ•£å‚æ•° k = 0.45ï¼Œå€¼è¶Šå°ï¼Œåˆ†å¸ƒè¶Šåˆ†æ•£
- è¿™æ„å‘³ç€ï¼šå¤§å¤šæ•°äººä¼ æŸ“æ€§è¾ƒä½ï¼Œå°‘æ•°äººä¼ æŸ“æ€§å¾ˆé«˜ï¼ˆ**è¶…çº§ä¼ æ’­è€…**ï¼‰
- å½“ k â†’ âˆ æ—¶ï¼Œé€€åŒ–ä¸ºæ³Šæ¾åˆ†å¸ƒï¼›å½“ k â†’ 0 æ—¶ï¼Œåˆ†æ•£æ€§æ›´å¤§

ğŸ“Š **åˆ†å¸ƒç‰¹æ€§å¯è§†åŒ–æè¿°**ï¼š

```
è´ŸäºŒé¡¹åˆ†å¸ƒ (mean=1.0, k=0.45)
â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆ
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ rel_trans
 0    0.5   1.0   1.5   2.0   2.5   3.0+
```

å¤§éƒ¨åˆ†äººçš„ `rel_trans` é›†ä¸­åœ¨ 0-1 ä¹‹é—´ï¼Œä½†æœ‰å°‘æ•°äººå¯ä»¥è¾¾åˆ° 3.0+ï¼Œè¿™å°±æ˜¯"è¶…çº§ä¼ æ’­è€…"æ•ˆåº”ã€‚

å¯¹åº”æºç ï¼ˆ`utils.py` `n_neg_binomial`ï¼‰ï¼š

```python
# utils.py ç¬¬409-427è¡Œ
def n_neg_binomial(rate, dispersion, n, step=1):
    nbn_n = dispersion
    nbn_p = dispersion / (rate/step + dispersion)
    samples = np.random.negative_binomial(n=nbn_n, p=nbn_p, size=n) * step
    return samples
```

**ç§‘å­¦ä¾æ®**ï¼š
- è´ŸäºŒé¡¹åˆ†å¸ƒçš„ç¦»æ•£å‚æ•°æ¥è‡ª https://www.researchsquare.com/article/rs-29548/v1
- COVID-19 ä¼ æ’­çš„é«˜åº¦å¼‚è´¨æ€§ï¼ˆè¶…çº§ä¼ æ’­è€…ç°è±¡ï¼‰å·²è¢«å¹¿æ³›è®°å½•

### 3.4 çªç ´æ€§æ„ŸæŸ“å¯¹ä¼ æŸ“æ€§çš„å½±å“

å½“å·²æœ‰å…ç–«ï¼ˆæœ‰NAbï¼‰çš„ä¸ªä½“è¢«å†æ¬¡æ„ŸæŸ“ï¼ˆçªç ´æ€§æ„ŸæŸ“ï¼‰æ—¶ï¼Œå…¶ä¼ æŸ“æ€§ä¼šé™ä½ï¼š

```
rel_trans(çªç ´æ€§æ„ŸæŸ“) = rel_trans Ã— trans_redux
```

å…¶ä¸­ `trans_redux = 0.59`ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œå³çªç ´æ€§æ„ŸæŸ“çš„ä¼ æŸ“æ€§é™ä½çº¦41%ã€‚

å¯¹åº”æºç ï¼ˆ`people.py` `infect` æ–¹æ³•ï¼‰ï¼š

```python
# people.py ç¬¬486-491è¡Œ
breakthrough_inds = inds[cvu.true(self.peak_nab[inds])]
if len(breakthrough_inds):
    no_prior_breakthrough = (self.n_breakthroughs[breakthrough_inds] == 0)
    new_breakthrough_inds = breakthrough_inds[no_prior_breakthrough]
    self.rel_trans[new_breakthrough_inds] *= self.pars['trans_redux']  # 0.59
```

> ğŸ’¡ **æ³¨æ„**ï¼šè¿™ä¸ªé™ä½åªåœ¨ç¬¬ä¸€æ¬¡çªç ´æ€§æ„ŸæŸ“æ—¶åº”ç”¨ä¸€æ¬¡ã€‚

---

## 4. ç—…æ¯’è½½é‡ï¼ˆViral Loadï¼‰æœºåˆ¶

### 4.1 ä»€ä¹ˆæ˜¯ç—…æ¯’è½½é‡ï¼Ÿ

åœ¨ Covasim ä¸­ï¼Œ"ç—…æ¯’è½½é‡"ï¼ˆviral loadï¼‰**å¹¶ä¸æ˜¯çœŸæ­£çš„ç—…æ¯’æ‹·è´æ•°**ï¼Œè€Œæ˜¯ä¸€ä¸ª**æ—¶å˜çš„ä¼ æŸ“æ€§è°ƒèŠ‚å› å­**ï¼Œç”¨æ¥æ¨¡æ‹Ÿæ„ŸæŸ“è€…åœ¨ä¸åŒé˜¶æ®µä¼ æŸ“èƒ½åŠ›çš„å˜åŒ–ï¼š

```
æ„ŸæŸ“ â†’ [æ½œä¼æœŸ] â†’ ä¼ æŸ“æœŸå¼€å§‹ â†’ é«˜è½½é‡é˜¶æ®µ â†’ ä½è½½é‡é˜¶æ®µ â†’ åº·å¤/æ­»äº¡
                                 â†‘                â†‘
                            ä¼ æŸ“æ€§è¾ƒé«˜          ä¼ æŸ“æ€§è¾ƒä½
```

### 4.2 ç—…æ¯’è½½é‡çš„å‚æ•°

ç—…æ¯’è½½é‡ç”±ä¸‰ä¸ªå‚æ•°æ§åˆ¶ï¼š

```python
viral_dist = {
    'frac_time': 0.3,    # é«˜è½½é‡é˜¶æ®µå æ€»ä¼ æŸ“æœŸçš„æ¯”ä¾‹ï¼ˆ30%ï¼‰
    'load_ratio': 2,     # é«˜è½½é‡ä¸ä½è½½é‡çš„æ¯”å€¼ï¼ˆ2å€ï¼‰
    'high_cap': 4        # é«˜è½½é‡é˜¶æ®µçš„æœ€å¤§å¤©æ•°ä¸Šé™ï¼ˆ4å¤©ï¼‰
}
```

| å‚æ•° | é»˜è®¤å€¼ | å«ä¹‰ |
|------|--------|------|
| `frac_time` | 0.3 | ä¼ æŸ“æœŸä¸­ï¼Œå‰30%çš„æ—¶é—´ä¸ºé«˜è½½é‡é˜¶æ®µ |
| `load_ratio` | 2 | é«˜è½½é‡é˜¶æ®µçš„ä¼ æŸ“æ€§æ˜¯ä½è½½é‡é˜¶æ®µçš„2å€ |
| `high_cap` | 4 | é«˜è½½é‡é˜¶æ®µæœ€å¤šæŒç»­4å¤© |

**ç§‘å­¦ä¾æ®**ï¼šå‚æ•°ä¼°è®¡æ¥è‡ª Lescure 2020, Lancetï¼ˆhttps://doi.org/10.1016/S1473-3099(20)30200-0ï¼‰

### 4.3 ç—…æ¯’è½½é‡çš„è®¡ç®—è¿‡ç¨‹ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰

`compute_viral_load()` å‡½æ•°æ˜¯è®¡ç®—ç—…æ¯’è½½é‡çš„æ ¸å¿ƒï¼Œä»¥ä¸‹æ˜¯å…¶å®Œæ•´é€»è¾‘ï¼š

**æ­¥éª¤1ï¼šç¡®å®šä¼ æŸ“æœŸç»ˆç‚¹**

```
time_stop = time_recovered  ï¼ˆå¦‚æœæœªæ­»äº¡ï¼‰
time_stop = time_dead       ï¼ˆå¦‚æœå·²æ­»äº¡ï¼‰
```

**æ­¥éª¤2ï¼šè®¡ç®—æ€»ä¼ æŸ“å¤©æ•°**

```
infect_days_total = time_stop - time_startï¼ˆä¼ æŸ“å¼€å§‹æ—¥æœŸï¼‰
```

**æ­¥éª¤3ï¼šè®¡ç®—é«˜è½½é‡é˜¶æ®µçš„è½¬æ¢ç‚¹**

```python
trans_day = frac_time Ã— infect_days_total  # é«˜è½½é‡åº”æŒç»­çš„å¤©æ•°

# å¦‚æœè¶…è¿‡ä¸Šé™ï¼ˆhigh_cap=4å¤©ï¼‰ï¼Œåˆ™é™åˆ¶
if trans_day > high_cap:
    trans_point = high_cap / infect_days_total  # ç”¨æ¯”ä¾‹è¡¨ç¤ºçš„å®é™…è½¬æ¢ç‚¹
else:
    trans_point = frac_time  # ä½¿ç”¨é»˜è®¤æ¯”ä¾‹
```

**æ­¥éª¤4ï¼šè®¡ç®—å½“å‰ç—…æ¯’è½½é‡**

```python
# åˆ¤æ–­å½“å‰æ—¶é—´å¤„äºå“ªä¸ªé˜¶æ®µ
progress = (t - time_start) / infect_days_total  # å½“å‰è¿›åº¦ï¼ˆ0åˆ°1ï¼‰

if progress < trans_point:
    # é«˜è½½é‡é˜¶æ®µ
    load = load_ratio / (1 + frac_time Ã— (load_ratio - 1))
else:
    # ä½è½½é‡é˜¶æ®µ
    load = 1 / (1 + frac_time Ã— (load_ratio - 1))
```

å¯¹åº”æºç ï¼ˆ`utils.py` `compute_viral_load`ï¼‰ï¼š

```python
# utils.py ç¬¬40-79è¡Œ
def compute_viral_load(t, time_start, time_recovered, time_dead,
                       frac_time, load_ratio, high_cap):
    # è·å–ç»“æŸæ—¥æœŸï¼ˆåº·å¤æˆ–æ­»äº¡ï¼‰
    n = len(time_dead)
    time_stop = np.ones(n, dtype=cvd.default_float) * time_recovered
    inds = ~np.isnan(time_dead)
    time_stop[inds] = time_dead[inds]

    # è®¡ç®—é«˜è½½é‡é˜¶æ®µçš„æŒç»­æ—¶é—´å’Œä¸Šé™
    infect_days_total = time_stop - time_start
    trans_day = frac_time * infect_days_total
    inds = trans_day > high_cap
    cap_frac = high_cap / infect_days_total[inds]

    # è·å–ä¿®æ­£åçš„è½¬æ¢ç‚¹
    trans_point = np.ones(n, dtype=cvd.default_float) * frac_time
    trans_point[inds] = cap_frac

    # è®¡ç®—è½½é‡
    load = np.ones(n, dtype=cvd.default_float)
    early = (t - time_start) / infect_days_total < trans_point  # æ˜¯å¦åœ¨æ—©æœŸï¼ˆé«˜è½½é‡ï¼‰é˜¶æ®µ
    load = (load_ratio * early + load * ~early) / (load + frac_time * (load_ratio - load))

    return load
```

### 4.4 ç—…æ¯’è½½é‡çš„å½’ä¸€åŒ–

ç—…æ¯’è½½é‡çš„è®¡ç®—ä½¿ç”¨äº†**å½’ä¸€åŒ–**ï¼Œç¡®ä¿æ•´ä¸ªä¼ æŸ“æœŸå†…çš„å¹³å‡è½½é‡ä¸º1ã€‚è¿™æ„å‘³ç€ï¼š

```
å¹³å‡è½½é‡ = frac_time Ã— load_high + (1-frac_time) Ã— load_low = 1
```

ç”±æ­¤å¯å¾—ï¼ˆé»˜è®¤å‚æ•° `frac_time=0.3`, `load_ratio=2`ï¼‰ï¼š

```
load_low  = 1 / (1 + frac_time Ã— (load_ratio - 1))
          = 1 / (1 + 0.3 Ã— (2 - 1))
          = 1 / 1.3
          â‰ˆ 0.769

load_high = load_ratio Ã— load_low
          = 2 Ã— 0.769
          â‰ˆ 1.538
```

**éªŒè¯**ï¼š`0.3 Ã— 1.538 + 0.7 Ã— 0.769 = 0.461 + 0.538 = 1.0` âœ“

### 4.5 ç—…æ¯’è½½é‡çš„æ—¶é—´æ¼”å˜å›¾

ä»¥ä¸€ä¸ªä¼ æŸ“æœŸä¸º10å¤©çš„ä¸ªä½“ä¸ºä¾‹ï¼ˆ`frac_time=0.3`, `load_ratio=2`, `high_cap=4`ï¼‰ï¼š

```
ä¼ æŸ“æ€§
 â†‘
 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ â”‚          â”‚
1.538 â”‚ é«˜è½½é‡é˜¶æ®µ â”‚
 â”‚ â”‚ (3å¤©)    â”‚
 â”‚ â”‚          â”‚
 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚            â”‚                          â”‚
0.769         â”‚     ä½è½½é‡é˜¶æ®µ (7å¤©)       â”‚
 â”‚            â”‚                          â”‚
 â”‚            â”‚                          â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â†’ å¤©æ•°
 0    1    2    3    4    5    6    7    8    9   10
```

```
é«˜è½½é‡é˜¶æ®µæŒç»­å¤©æ•° = min(frac_time Ã— æ€»å¤©æ•°, high_cap)
                   = min(0.3 Ã— 10, 4)
                   = min(3, 4)
                   = 3å¤©
```

### 4.6 ä¸åŒä¼ æŸ“æœŸé•¿åº¦ä¸‹çš„ç—…æ¯’è½½é‡

| ä¼ æŸ“æœŸæ€»å¤©æ•° | é«˜è½½é‡å¤©æ•° | é«˜è½½é‡å€¼ | ä½è½½é‡å€¼ | æ˜¯å¦è§¦åŠä¸Šé™ |
|-------------|-----------|---------|---------|------------|
| 5å¤© | 1.5å¤© | 1.538 | 0.769 | å¦ |
| 8å¤© | 2.4å¤© | 1.538 | 0.769 | å¦ |
| 10å¤© | 3å¤© | 1.538 | 0.769 | å¦ |
| 14å¤©ï¼ˆçº¦13.3å¤©è§¦åŠï¼‰ | 4å¤©ï¼ˆä¸Šé™ï¼‰ | ~1.538 | ~0.769 | æ˜¯ |
| 20å¤© | 4å¤©ï¼ˆä¸Šé™ï¼‰ | ~1.538 | ~0.769 | æ˜¯ |

> ğŸ’¡ **å…³é”®ç†è§£**ï¼š
> - ä¼ æŸ“æœŸçŸ­çš„äººï¼šé«˜è½½é‡é˜¶æ®µå 30%ï¼Œä½†å¤©æ•°å°‘
> - ä¼ æŸ“æœŸé•¿çš„äººï¼šé«˜è½½é‡é˜¶æ®µæœ€å¤š4å¤©ï¼ˆå— `high_cap` é™åˆ¶ï¼‰ï¼Œä¹‹åéƒ½æ˜¯ä½è½½é‡
> - ç—…æ¯’è½½é‡æ˜¯ä¸€ä¸ª**ç›¸å¯¹è°ƒèŠ‚å› å­**ï¼Œä¸æ˜¯ç»å¯¹çš„ç—…æ¯’æ‹·è´æ•°

### 4.7 ç—…æ¯’è½½é‡ä½•æ—¶ä¸º0ï¼Ÿ

ä»¥ä¸‹æƒ…å†µç—…æ¯’è½½é‡ä¸å‚ä¸ä¼ æ’­è®¡ç®—ï¼ˆæˆ–ç­‰æ•ˆä¸º0ï¼‰ï¼š
- **æœªæ„ŸæŸ“çš„äºº**ï¼š`inf(i) = 0`ï¼Œæ‰€ä»¥ `rel_trans` æ•´ä½“ä¸º0
- **å¤„äºæ½œä¼æœŸçš„äºº**ï¼šå°šæœªåˆ° `date_infectious`ï¼Œ`infectious = False`
- **å·²åº·å¤æˆ–å·²æ­»äº¡çš„äºº**ï¼šä¸å†å¤„äºä¼ æŸ“çŠ¶æ€

ç—…æ¯’è½½é‡å‡½æ•°æœ¬èº«å¯¹æ‰€æœ‰äººéƒ½ä¼šè®¡ç®—ï¼Œä½†åªæœ‰ `infectious = True` çš„äººçš„è½½é‡æ‰ä¼šå½±å“ä¼ æ’­ã€‚

---

## 5. ä¼ æ’­æ¦‚ç‡çš„å®Œæ•´è®¡ç®—

### 5.1 ä¼ æŸ“æ€§å› å­çš„ç»„åˆ

å¯¹äºä¼ æŸ“æº iï¼Œå…¶æœ‰æ•ˆä¼ æŸ“æ€§ä¸ºå¤šä¸ªå› å­çš„ä¹˜ç§¯ï¼š

```
effective_trans(i) = rel_trans(i) Ã— inf(i) Ã— viral_load(i) Ã— f_asymp(i) Ã— f_iso(i) Ã— f_quar(i) Ã— beta_layer
```

å„å› å­çš„è®¡ç®—é€»è¾‘ï¼š

| å› å­ | æœ‰çŠ¶æ€æ—¶ | æ— çŠ¶æ€æ—¶ | è¯´æ˜ |
|------|---------|---------|------|
| `f_asymp` | 1.0ï¼ˆæœ‰ç—‡çŠ¶ï¼‰ | `asymp_factor`ï¼ˆæ— ç—‡çŠ¶ï¼‰ | é»˜è®¤ `asymp_factor=1.0`ï¼Œå³æ— å·®å¼‚ |
| `f_iso` | `iso_factor`ï¼ˆè¢«éš”ç¦»ï¼‰ | 1.0ï¼ˆæœªéš”ç¦»ï¼‰ | `iso_factor` ç”±å±‚å†³å®šï¼Œé€šå¸¸å¾ˆå° |
| `f_quar` | `quar_factor`ï¼ˆè¢«éš”ç¦»ï¼‰ | 1.0ï¼ˆæœªéš”ç¦»ï¼‰ | `quar_factor` ç”±å±‚å†³å®š |

å¯¹åº”æºç é€»è¾‘ï¼š

```python
f_asymp = symp + ~symp * asymp_factor
# å¦‚æœæœ‰ç—‡çŠ¶(symp=True=1): f_asymp = 1 + 0 Ã— asymp_factor = 1.0
# å¦‚æœæ— ç—‡çŠ¶(symp=False=0): f_asymp = 0 + 1 Ã— asymp_factor = asymp_factor

f_iso = ~iso + iso * iso_factor
# å¦‚æœæœªéš”ç¦»(iso=False): f_iso = 1 + 0 Ã— iso_factor = 1.0
# å¦‚æœè¢«éš”ç¦»(iso=True):  f_iso = 0 + 1 Ã— iso_factor = iso_factorï¼ˆå¾ˆå°çš„å€¼ï¼‰

f_quar = ~quar + quar * quar_factor
# å¦‚æœæœªéš”ç¦»(quar=False): f_quar = 1 + 0 Ã— quar_factor = 1.0
# å¦‚æœè¢«éš”ç¦»(quar=True):  f_quar = 0 + 1 Ã— quar_factor = quar_factor
```

### 5.2 æ˜“æ„Ÿæ€§å› å­çš„ç»„åˆ

å¯¹äºç›®æ ‡ jï¼Œå…¶æœ‰æ•ˆæ˜“æ„Ÿæ€§ä¸ºï¼š

```
effective_sus(j) = rel_sus(j) Ã— sus(j) Ã— f_quar(j) Ã— (1 - sus_imm(j))
```

å„å› å­è¯´æ˜ï¼š
- `rel_sus(j)`ï¼šåŸºäºå¹´é¾„çš„ç›¸å¯¹æ˜“æ„Ÿæ€§ï¼ˆ0-9å²ä¸º0.34ï¼Œ20-49å²ä¸º1.00ï¼Œ60+å²çº¦1.24-1.47ï¼‰
- `sus(j)`ï¼šæ˜¯å¦å¤„äºæ˜“æ„ŸçŠ¶æ€ï¼ˆå¸ƒå°”å€¼ï¼‰
- `f_quar(j)`ï¼šéš”ç¦»å› å­ï¼ˆåŒä¸Šï¼‰
- `sus_imm(j)`ï¼šå…ç–«ä¿æŠ¤å› å­ï¼ˆ0åˆ°1ï¼Œæ¥è‡ªNAbæ°´å¹³ï¼Œå€¼è¶Šå¤§ä¿æŠ¤è¶Šå¼ºï¼‰

**å¹´é¾„ç›¸å…³æ˜“æ„Ÿæ€§ï¼ˆsus_ORsï¼‰**ï¼š

| å¹´é¾„ç»„ | 0-9 | 10-19 | 20-29 | 30-39 | 40-49 | 50-59 | 60-69 | 70-79 | 80-89 | 90+ |
|--------|-----|-------|-------|-------|-------|-------|-------|-------|-------|-----|
| sus_ORs | 0.34 | 0.67 | 1.00 | 1.00 | 1.00 | 1.00 | 1.24 | 1.47 | 1.47 | 1.47 |

**ç§‘å­¦ä¾æ®**ï¼šæ¥è‡ª Zhang et al., https://science.sciencemag.org/content/early/2020/05/04/science.abb8001

### 5.3 æœ€ç»ˆä¼ æ’­æ¦‚ç‡

å¯¹äºæ¥è§¦å¯¹ (i, j)ï¼Œå…¶ä¼ æ’­æ¦‚ç‡ä¸ºï¼š

```
P(ä¼ æ’­) = Î²_total Ã— effective_trans(i) Ã— effective_sus(j) Ã— layer_beta(i,j)
```

å…¶ä¸­ `layer_beta(i,j)` æ˜¯è¯¥æ¥è§¦å¯¹åœ¨æ¥è§¦ç½‘ç»œä¸­çš„è¾¹æƒé‡ï¼ˆé€šå¸¸ä¸º1.0ï¼‰ã€‚

å¯¹åº”æºç ï¼ˆ`utils.py` `compute_infections`ï¼‰ï¼š

```python
# utils.py ç¬¬94-128è¡Œ
def compute_infections(beta, p1, p2, layer_betas, rel_trans, rel_sus, legacy=False):
    for sources, targets in pairs:
        source_trans = rel_trans[sources]  # è·å–ä¼ æŸ“æºçš„ä¼ æŸ“æ€§
        inf_inds = source_trans.nonzero()[0]  # æ‰¾åˆ°æœ‰ä¼ æŸ“æ€§çš„äºº
        # è®¡ç®—åŸå§‹ä¼ æ’­æ¦‚ç‡
        betas = beta * layer_betas[inf_inds] * source_trans[inf_inds] * rel_sus[targets[inf_inds]]
        # é€šè¿‡ä¼¯åŠªåˆ©è¯•éªŒå†³å®šæ˜¯å¦ä¼ æ’­
        transmissions = (np.random.random(len(nonzero_betas)) < nonzero_betas).nonzero()[0]
    return source_inds, target_inds
```

---

## 6. æ„ŸæŸ“åˆ¤å®šè¿‡ç¨‹

### 6.1 æ¥è§¦ç½‘ç»œç»“æ„

Covasim ä¸­çš„æ¥è§¦ç½‘ç»œç”±å¤šä¸ª"å±‚"ï¼ˆLayerï¼‰ç»„æˆï¼Œæ¯å±‚ä»£è¡¨ä¸åŒç±»å‹çš„ç¤¾ä¼šæ¥è§¦ï¼š

**éšæœºç½‘ç»œï¼ˆrandomï¼‰**ï¼š
- åªæœ‰ä¸€ä¸ªå±‚ `'a'`ï¼ˆallï¼‰ï¼Œé»˜è®¤æ¯äºº20ä¸ªæ¥è§¦

**æ··åˆç½‘ç»œï¼ˆhybridï¼‰**ï¼š
- `'h'`ï¼ˆhouseholdï¼‰ï¼šå®¶åº­æ¥è§¦ï¼Œçº¦4äºº
- `'s'`ï¼ˆschoolï¼‰ï¼šå­¦æ ¡æ¥è§¦ï¼Œçº¦20äººï¼ˆä»…å­¦é¾„äººç¾¤ï¼‰
- `'w'`ï¼ˆworkï¼‰ï¼šå·¥ä½œæ¥è§¦ï¼Œçº¦16äººï¼ˆä»…å·¥ä½œå¹´é¾„äººç¾¤ï¼‰
- `'c'`ï¼ˆcommunityï¼‰ï¼šç¤¾åŒºæ¥è§¦ï¼Œçº¦20äººï¼ˆæ‰€æœ‰äººï¼Œæ¯å¤©åŠ¨æ€æ›´æ–°ï¼‰

**åˆæˆäººå£ç½‘ç»œï¼ˆsynthpopsï¼‰**ï¼š
- ä½¿ç”¨ SynthPops åŒ…ç”Ÿæˆæ›´çœŸå®çš„ç¤¾ä¼šç½‘ç»œ

æ¯ä¸ªæ¥è§¦å±‚éƒ½æœ‰è‡ªå·±çš„ä¼ æ’­æƒé‡ `beta_layer`ï¼š

```python
# é»˜è®¤çš„å±‚ä¼ æ’­æƒé‡
beta_layer = {
    'h': 3.0,   # å®¶åº­å†…ä¼ æ’­ç‡é«˜
    's': 0.6,   # å­¦æ ¡ä¼ æ’­ç‡ä¸­ç­‰
    'w': 0.6,   # å·¥ä½œåœºæ‰€ä¼ æ’­ç‡ä¸­ç­‰
    'c': 0.3,   # ç¤¾åŒºä¼ æ’­ç‡è¾ƒä½
}
```

### 6.2 æ¥è§¦å¯¹çš„éå†

å¯¹äºæ¯ä¸ªæ¥è§¦å±‚ï¼ŒCovasim éå†æ‰€æœ‰æ¥è§¦å¯¹ (p1, p2)ï¼Œè®¡ç®—ä¼ æ’­æ¦‚ç‡ï¼š

æ¥è§¦å±‚æ•°æ®ç»“æ„ï¼š

```python
Layer = {
    'p1':   [0, 0, 1, 2, ...],   # æ¥è§¦å¯¹çš„ä¸€æ–¹
    'p2':   [3, 7, 5, 8, ...],   # æ¥è§¦å¯¹çš„å¦ä¸€æ–¹
    'beta': [1.0, 1.0, 1.0, ...] # æ¯å¯¹æ¥è§¦çš„æƒé‡
}
```

### 6.3 åŒå‘ä¼ æ’­

é»˜è®¤æƒ…å†µä¸‹ï¼ŒCovasim ä½¿ç”¨å•å‘éå†ä½†åŒå‘ä¼ æ’­ï¼š
- å¯¹äºæ¥è§¦å¯¹ (p1, p2)ï¼ŒåŒæ—¶æ£€æŸ¥ p1â†’p2 å’Œ p2â†’p1 æ–¹å‘çš„ä¼ æ’­
- è¿™æ˜¯é€šè¿‡åœ¨ `compute_infections` å†…éƒ¨éå† `[[p1,p2], [p2,p1]]` å®ç°çš„

å¯¹åº”æºç ï¼š

```python
# utils.py ç¬¬113-127è¡Œ
pairs = [[p1,p2], [p2,p1]] if not legacy else [[p1,p2]]
for sources, targets in pairs:
    source_trans = rel_trans[sources]
    inf_inds = source_trans.nonzero()[0]
    betas = beta * layer_betas[inf_inds] * source_trans[inf_inds] * rel_sus[targets[inf_inds]]
    transmissions = (np.random.random(len(nonzero_betas)) < nonzero_betas).nonzero()[0]
```

### 6.4 æ„ŸæŸ“åˆ¤å®šçš„ä¼¯åŠªåˆ©è¯•éªŒ

æœ€ç»ˆçš„æ„ŸæŸ“åˆ¤å®šæ˜¯ä¸€ä¸ªç®€å•çš„ä¼¯åŠªåˆ©è¯•éªŒï¼š

```python
if random() < P(ä¼ æ’­):
    å‘ç”Ÿæ„ŸæŸ“
else:
    æœªå‘ç”Ÿæ„ŸæŸ“
```

å¯¹åº”æºç ï¼š

```python
transmissions = (np.random.random(len(nonzero_betas)) < nonzero_betas).nonzero()[0]
```

---

## 7. æ„ŸæŸ“åå¤„ç†ï¼ˆinfectå‡½æ•°ï¼‰

### 7.1 infect() å‡½æ•°çš„å®Œæ•´æµç¨‹

å½“ä¸€ä¸ªäººè¢«ç¡®å®šæ„ŸæŸ“åï¼Œ`infect()` å‡½æ•°æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   infect() å®Œæ•´æµç¨‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. å»é‡å’Œè¿‡æ»¤                                            â”‚
â”‚     â”œâ”€ ç§»é™¤é‡å¤æ„ŸæŸ“ï¼ˆåŒä¸€æ—¶é—´æ­¥è¢«å¤šäººæ„ŸæŸ“åªç®—ä¸€æ¬¡ï¼‰         â”‚
â”‚     â””â”€ åªä¿ç•™æ˜“æ„Ÿä¸ªä½“                                     â”‚
â”‚                                                          â”‚
â”‚  2. çªç ´æ€§æ„ŸæŸ“å¤„ç†                                        â”‚
â”‚     â””â”€ å¦‚æœæœ‰NAbï¼ˆå·²æœ‰å…ç–«ï¼‰ï¼Œé™ä½ä¼ æŸ“æ€§ Ã—0.59            â”‚
â”‚                                                          â”‚
â”‚  3. æ›´æ–°çŠ¶æ€                                              â”‚
â”‚     â”œâ”€ susceptible = False                               â”‚
â”‚     â”œâ”€ naive = False                                     â”‚
â”‚     â”œâ”€ exposed = True                                    â”‚
â”‚     â””â”€ è®°å½•æ„ŸæŸ“å˜ç§                                       â”‚
â”‚                                                          â”‚
â”‚  4. ç¡®å®šæ½œä¼æœŸ                                            â”‚
â”‚     â””â”€ dur_exp2inf ~ LogNormal(4.5, 1.5)                 â”‚
â”‚                                                          â”‚
â”‚  5. ç¡®å®šé¢„åè·¯å¾„ï¼ˆåœ¨æ„ŸæŸ“æ—¶å°±å†³å®šï¼ï¼‰                       â”‚
â”‚     â”œâ”€ æ˜¯å¦å‡ºç°ç—‡çŠ¶ï¼Ÿ â†’ symp_prob Ã— (1-symp_imm)         â”‚
â”‚     â”‚  â”œâ”€ æ— ç—‡çŠ¶ â†’ ç›´æ¥ç¡®å®šåº·å¤æ—¥æœŸ                       â”‚
â”‚     â”‚  â””â”€ æœ‰ç—‡çŠ¶ â†’ æ˜¯å¦é‡ç—‡ï¼Ÿ                             â”‚
â”‚     â”‚     â”œâ”€ è½»ç—‡ â†’ ç¡®å®šåº·å¤æ—¥æœŸ                          â”‚
â”‚     â”‚     â””â”€ é‡ç—‡ â†’ æ˜¯å¦å±é‡ï¼Ÿ                            â”‚
â”‚     â”‚        â”œâ”€ éå±é‡ â†’ ç¡®å®šåº·å¤æ—¥æœŸ                     â”‚
â”‚     â”‚        â””â”€ å±é‡ â†’ æ˜¯å¦æ­»äº¡ï¼Ÿ                         â”‚
â”‚     â”‚           â”œâ”€ å­˜æ´» â†’ ç¡®å®šåº·å¤æ—¥æœŸ                    â”‚
â”‚     â”‚           â””â”€ æ­»äº¡ â†’ ç¡®å®šæ­»äº¡æ—¥æœŸ                    â”‚
â”‚     â”‚                                                    â”‚
â”‚  6. æ›´æ–°å…ç–«ï¼ˆå¦‚æœå¯ç”¨waningï¼‰                            â”‚
â”‚     â””â”€ update_peak_nab() è®¾ç½®å³°å€¼NAbæ°´å¹³                 â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å…³é”®æ—¶é—´çº¿ç¡®å®š

æ„ŸæŸ“æ—¶å°±ç¡®å®šäº†æ•´ä¸ªç–¾ç—…è¿›ç¨‹çš„æ—¶é—´çº¿ï¼š

```python
# æ½œä¼æœŸ
dur_exp2inf ~ LogNormal(mean=4.5, std=1.5)
date_infectious = date_exposed + dur_exp2inf

# æ— ç—‡çŠ¶è·¯å¾„
dur_asym2rec ~ LogNormal(mean=8.0, std=2.0)
date_recovered = date_infectious + dur_asym2rec

# æœ‰ç—‡çŠ¶è·¯å¾„
dur_inf2sym ~ LogNormal(mean=1.1, std=0.9)
date_symptomatic = date_infectious + dur_inf2sym

# è½»ç—‡åº·å¤
dur_mild2rec ~ LogNormal(mean=8.0, std=2.0)
date_recovered = date_symptomatic + dur_mild2rec

# é‡ç—‡
dur_sym2sev ~ LogNormal(mean=6.6, std=4.9)
date_severe = date_symptomatic + dur_sym2sev

# å±é‡
dur_sev2crit ~ LogNormal(mean=1.5, std=2.0)
date_critical = date_severe + dur_sev2crit

# å±é‡åº·å¤
dur_crit2rec ~ LogNormal(mean=18.1, std=6.3)
date_recovered = date_critical + dur_crit2rec

# å±é‡æ­»äº¡
dur_crit2die ~ LogNormal(mean=10.7, std=4.8)
date_dead = date_critical + dur_crit2die
```

### 7.3 é¢„åæ¦‚ç‡çš„ç¡®å®š

é¢„åæ¦‚ç‡å—åˆ°å¤šä¸ªå› ç´ çš„å½±å“ï¼š

```python
# ç—‡çŠ¶æ¦‚ç‡ï¼ˆå—å…ç–«ä¿æŠ¤å½±å“ï¼‰
symp_prob_actual = rel_symp_prob Ã— symp_prob(age) Ã— (1 - symp_imm[variant])

# é‡ç—‡æ¦‚ç‡ï¼ˆå—å…ç–«ä¿æŠ¤å½±å“ï¼‰
sev_prob_actual = rel_severe_prob Ã— severe_prob(age) Ã— (1 - sev_imm[variant])

# å±é‡æ¦‚ç‡ï¼ˆå—åŒ»ç–—èµ„æºå½±å“ï¼‰
crit_prob_actual = rel_crit_prob Ã— crit_prob(age) Ã— no_hosp_factorï¼ˆå¦‚æœåŒ»é™¢æ»¡å‘˜ï¼‰

# æ­»äº¡æ¦‚ç‡ï¼ˆå—ICUèµ„æºå½±å“ï¼‰
death_prob_actual = rel_death_prob Ã— death_prob(age) Ã— no_icu_factorï¼ˆå¦‚æœICUæ»¡å‘˜ï¼‰
```

å¯¹åº”æºç ï¼š

```python
# people.py ç¬¬522-566è¡Œ
symp_probs = infect_pars['rel_symp_prob'] * self.symp_prob[inds] * (1-self.symp_imm[variant, inds])
is_symp = cvu.binomial_arr(symp_probs)

sev_probs = infect_pars['rel_severe_prob'] * self.severe_prob[symp_inds] * (1-self.sev_imm[variant, symp_inds])
is_sev = cvu.binomial_arr(sev_probs)

crit_probs = infect_pars['rel_crit_prob'] * self.crit_prob[sev_inds] * (no_hosp_factor if hosp_max else 1.)
is_crit = cvu.binomial_arr(crit_probs)

death_probs = infect_pars['rel_death_prob'] * self.death_prob[crit_inds] * (no_icu_factor if icu_max else 1.)
is_dead = cvu.binomial_arr(death_probs)
```

---

## 8. å˜ç§ç—…æ¯’å¯¹ä¼ æ’­çš„å½±å“

### 8.1 å˜ç§å¦‚ä½•å½±å“ä¼ æ’­

æ¯ä¸ªå˜ç§æœ‰è‡ªå·±çš„ `rel_beta` å‚æ•°ï¼Œç›´æ¥ä¹˜åˆ°åŸºç¡€ä¼ æ’­ç‡ä¸Šï¼š

```
beta_effective = Î² Ã— rel_beta_global Ã— rel_beta_variant
```

**é¢„å®šä¹‰å˜ç§çš„ä¼ æ’­å‚æ•°**ï¼š

| å˜ç§ | rel_beta | è¯´æ˜ |
|------|----------|------|
| Wildï¼ˆåŸå§‹æ ªï¼‰ | 1.0 | åŸºå‡†å€¼ |
| Alpha (B.1.1.7) | 1.67 | ä¼ æ’­ç‡çº¦ä¸ºåŸå§‹æ ªçš„1.67å€ |
| Beta (B.1.351) | 1.0 | ä¼ æ’­ç‡æ— å¢åŠ ï¼Œä¼˜åŠ¿æ¥è‡ªå…ç–«é€ƒé€¸ |
| Gamma (P.1) | 2.05 | ä¼ æ’­ç‡çº¦ä¸ºåŸå§‹æ ªçš„2.05å€ |
| Delta (B.1.617.2) | 2.2 | ä¼ æ’­ç‡çº¦ä¸ºåŸå§‹æ ªçš„2.2å€ |

### 8.2 å˜ç§å¯¹ç–¾ç—…ä¸¥é‡ç¨‹åº¦çš„å½±å“

å˜ç§è¿˜é€šè¿‡è°ƒæ•´é¢„åæ¦‚ç‡å½±å“ç–¾ç—…è¿›å±•ï¼š

```python
# people.py ç¬¬475-481è¡Œ
variant_keys = ['rel_symp_prob', 'rel_severe_prob', 'rel_crit_prob', 'rel_death_prob']
infect_pars = {k: self.pars[k] for k in variant_keys}
variant_label = self.pars['variant_map'][variant]
if variant:
    for k in variant_keys:
        infect_pars[k] *= self.pars['variant_pars'][variant_label][k]
```

### 8.3 å˜ç§é—´çš„ä¼ æ’­ç«äº‰

å½“å¤šä¸ªå˜ç§åŒæ—¶å­˜åœ¨æ—¶ï¼Œæ¯ä¸ªå˜ç§ç‹¬ç«‹è®¡ç®—ä¼ æ’­ï¼š

```python
# sim.py ç¬¬621-649è¡Œ
for variant in range(nv):
    beta = self['beta'] * self['rel_beta'] * self['variant_pars'][variant_label]['rel_beta']
    inf_variant = people.infectious * (people.infectious_variant == variant)
    # åªæœ‰æ„ŸæŸ“äº†è¯¥å˜ç§çš„äººæ‰èƒ½ä¼ æ’­è¯¥å˜ç§
    for lkey, layer in contacts.items():
        rel_trans, rel_sus = cvu.compute_trans_sus(...)
        source_inds, target_inds = cvu.compute_infections(beta, ...)
        people.infect(inds=target_inds, variant=variant)
```

> ğŸ’¡ **å…³é”®ç‚¹**ï¼šä¸€ä¸ªäººåœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªå˜ç§æ„ŸæŸ“ï¼Œä½†åº·å¤åå¯ä»¥è¢«å…¶ä»–å˜ç§å†æ¬¡æ„ŸæŸ“ã€‚

---

## 9. å…ç–«å¯¹ä¼ æ’­çš„å½±å“

### 9.1 å…ç–«å¦‚ä½•é™ä½ä¼ æ’­

å…ç–«é€šè¿‡ä¸¤ä¸ªé€”å¾„å½±å“ä¼ æ’­ï¼š

1. **é™ä½æ˜“æ„Ÿæ€§**ï¼ˆå‡å°‘è¢«æ„ŸæŸ“çš„æ¦‚ç‡ï¼‰ï¼š
   ```
   effective_sus = rel_sus Ã— (1 - sus_imm)
   ```
   å…¶ä¸­ `sus_imm` æ¥è‡ª NAb æ°´å¹³ç»è¿‡ `calc_VE()` è½¬æ¢

2. **é™ä½çªç ´æ€§æ„ŸæŸ“çš„ä¼ æŸ“æ€§**ï¼š
   å¦‚æœå·²æœ‰å…ç–«çš„äººè¢«å†æ¬¡æ„ŸæŸ“ï¼Œå…¶ `rel_trans` ä¹˜ä»¥ `trans_redux` (0.59)

### 9.2 å…ç–«ä¿æŠ¤å› å­çš„è®¡ç®—

å…ç–«ä¿æŠ¤å› å­ `sus_imm` é€šè¿‡ä»¥ä¸‹æµç¨‹è®¡ç®—ï¼š

```
NAbæ°´å¹³ â†’ äº¤å‰å…ç–«åŠ æƒ â†’ calc_VE() â†’ sus_imm
```

```python
effective_nabs = nab Ã— max(natural_imm, vaccine_imm)
sus_imm = calc_VE(effective_nabs, 'sus', nab_eff)
```

å…¶ä¸­ `calc_VE` ä½¿ç”¨é€†logitå‡½æ•°ï¼š

```
VE(nab) = exp(Î±) Ã— nab^Î² / (1 + exp(Î±) Ã— nab^Î²)
```

é»˜è®¤å‚æ•°ï¼š`alpha_inf = 1.08`, `beta_inf = 0.967`

å¯¹åº”æºç ï¼ˆ`immunity.py` `check_immunity`ï¼‰ï¼š

```python
# immunity.py ç¬¬303-350è¡Œ
def check_immunity(people, variants=None):
    for variant in variants:
        # è‡ªç„¶å…ç–«åŠ æƒ
        natural_imm[was_inf] = immunity[variant, recovered_variant]
        # ç–«è‹—å…ç–«åŠ æƒ
        vaccine_imm[is_vacc] = imm_arr[vacc_source]
        # å–è¾ƒå¤§å€¼
        imm = np.maximum(natural_imm, vaccine_imm)
        effective_nabs = people.nab * imm
        # è½¬æ¢ä¸ºä¿æŠ¤å› å­
        people.sus_imm[variant, :] = calc_VE(effective_nabs, 'sus', nab_eff)
```

### 9.3 å…ç–«å¯¹ä¼ æ’­é“¾çš„å®Œæ•´å½±å“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å…ç–«å¯¹ä¼ æ’­çš„å®Œæ•´å½±å“é“¾                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  æ„ŸæŸ“/æ¥ç§ç–«è‹—                                           â”‚
â”‚       â†“                                                 â”‚
â”‚  äº§ç”Ÿ NAbï¼ˆå³°å€¼æ°´å¹³ç”±æ„ŸæŸ“ä¸¥é‡ç¨‹åº¦/ç–«è‹—ç±»å‹å†³å®šï¼‰          â”‚
â”‚       â†“                                                 â”‚
â”‚  NAb éšæ—¶é—´è¡°å‡ï¼ˆnab_growth_decay å‡½æ•°ï¼‰                 â”‚
â”‚       â†“                                                 â”‚
â”‚  æ¯ä¸ªæ—¶é—´æ­¥è®¡ç®— effective_nabs = nab Ã— äº¤å‰å…ç–«å› å­       â”‚
â”‚       â†“                                                 â”‚
â”‚  calc_VE() è½¬æ¢ä¸ºä¿æŠ¤å› å­                                â”‚
â”‚       â†“                                                 â”‚
â”‚  â”Œâ”€ sus_imm: é™ä½è¢«æ„ŸæŸ“æ¦‚ç‡                              â”‚
â”‚  â”‚    â†’ rel_sus Ã— (1 - sus_imm)                         â”‚
â”‚  â”œâ”€ symp_imm: é™ä½å‡ºç°ç—‡çŠ¶æ¦‚ç‡                           â”‚
â”‚  â”‚    â†’ symp_prob Ã— (1 - symp_imm)                      â”‚
â”‚  â””â”€ sev_imm: é™ä½é‡ç—‡æ¦‚ç‡                                â”‚
â”‚       â†’ severe_prob Ã— (1 - sev_imm)                     â”‚
â”‚                                                         â”‚
â”‚  å¦‚æœä»ç„¶è¢«æ„ŸæŸ“ï¼ˆçªç ´æ€§æ„ŸæŸ“ï¼‰ï¼š                           â”‚
â”‚  â†’ rel_trans Ã— trans_redux (0.59)  é™ä½ä¼ æŸ“æ€§             â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. å®Œæ•´ç¤ºä¾‹

### 10.1 ç¤ºä¾‹1ï¼šè§‚å¯Ÿä¼ æ’­è¿‡ç¨‹

```python
import covasim as cv
import numpy as np

# åˆ›å»ºä¸€ä¸ªå°è§„æ¨¡æ¨¡æ‹Ÿï¼Œä¾¿äºè§‚å¯Ÿ
sim = cv.Sim(
    pop_size=1000,
    pop_infected=5,
    n_days=60,
    beta=0.016,
    verbose=0,
)
sim.run()

# æŸ¥çœ‹ä¼ æ’­ç»“æœ
print(f"æ€»æ„ŸæŸ“äººæ•°: {sim.results['cum_infections'][-1]:.0f}")
print(f"å³°å€¼ä¼ æŸ“äººæ•°: {max(sim.results['n_infectious']):.0f}")
print(f"æœ€ç»ˆR_eff: {sim.results['r_eff'][-1]:.2f}")

# ç»˜åˆ¶ç»“æœ
sim.plot()
```

### 10.2 ç¤ºä¾‹2ï¼šæ¯”è¾ƒä¸åŒbetaå€¼çš„ä¼ æ’­æ•ˆæœ

```python
import covasim as cv

# åˆ›å»ºä¸åŒbetaçš„æ¨¡æ‹Ÿ
sims = []
for beta in [0.010, 0.016, 0.025]:
    sim = cv.Sim(pop_size=10000, beta=beta, n_days=90, verbose=0, label=f'beta={beta}')
    sims.append(sim)

msim = cv.MultiSim(sims)
msim.run()
msim.plot()
```

### 10.3 ç¤ºä¾‹3ï¼šè§‚å¯Ÿç—…æ¯’è½½é‡çš„å½±å“

```python
import covasim as cv
import numpy as np

# å¯¹æ¯”ä¸åŒçš„viral_distå‚æ•°
sim1 = cv.Sim(
    pop_size=10000,
    n_days=90,
    verbose=0,
    viral_dist=dict(frac_time=0.3, load_ratio=2, high_cap=4),
    label='é»˜è®¤è½½é‡å‚æ•°'
)

sim2 = cv.Sim(
    pop_size=10000,
    n_days=90,
    verbose=0,
    viral_dist=dict(frac_time=0.5, load_ratio=5, high_cap=4),
    label='é«˜å³°å€¼è½½é‡'
)

msim = cv.MultiSim([sim1, sim2])
msim.run()
msim.plot()
```

### 10.4 ç¤ºä¾‹4ï¼šè¿½è¸ªä¸ªä½“ä¼ æ’­é“¾

```python
import covasim as cv

sim = cv.Sim(pop_size=1000, pop_infected=1, n_days=30, verbose=0)
sim.run()

# æŸ¥çœ‹ä¼ æ’­æ—¥å¿—
for entry in sim.people.infection_log[:10]:
    print(f"Day {entry['date']}: Person {entry['source']} â†’ Person {entry['target']} "
          f"(Layer: {entry['layer']}, Variant: {entry['variant']})")

# æŸ¥çœ‹ç‰¹å®šä¸ªä½“çš„æ•…äº‹
sim.people.story(0)
```

### 10.5 ç¤ºä¾‹5ï¼šè‡ªå®šä¹‰ä¸ªä½“ä¼ æŸ“æ€§åˆ†å¸ƒ

```python
import covasim as cv

# ä½¿ç”¨ä¸åŒçš„beta_distæ¥æ¨¡æ‹Ÿè¶…çº§ä¼ æ’­è€…æ•ˆåº”
# æ›´å°çš„kå€¼ â†’ æ›´å¤šçš„è¶…çº§ä¼ æ’­è€…
sim_low_k = cv.Sim(
    pop_size=10000,
    n_days=90,
    verbose=0,
    beta_dist=dict(dist='neg_binomial', par1=1.0, par2=0.1, step=0.01),
    label='å¼ºè¶…çº§ä¼ æ’­è€… (k=0.1)'
)

# è¾ƒå¤§çš„kå€¼ â†’ æ›´å‡åŒ€çš„ä¼ æ’­
sim_high_k = cv.Sim(
    pop_size=10000,
    n_days=90,
    verbose=0,
    beta_dist=dict(dist='neg_binomial', par1=1.0, par2=2.0, step=0.01),
    label='å‡åŒ€ä¼ æ’­ (k=2.0)'
)

# é»˜è®¤kå€¼
sim_default = cv.Sim(
    pop_size=10000,
    n_days=90,
    verbose=0,
    beta_dist=dict(dist='neg_binomial', par1=1.0, par2=0.45, step=0.01),
    label='é»˜è®¤ (k=0.45)'
)

msim = cv.MultiSim([sim_low_k, sim_default, sim_high_k])
msim.run()
msim.plot()
```

### 10.6 ç¤ºä¾‹6ï¼šè‡ªå®šä¹‰ä¼ æ’­è¿½è¸ªåˆ†æå™¨

```python
import covasim as cv
import numpy as np
import matplotlib.pyplot as plt

class TransmissionTracker(cv.Analyzer):
    '''è¿½è¸ªæ¯æ—¥ä¼ æ’­çš„è¯¦ç»†ä¿¡æ¯'''

    def initialize(self, sim):
        super().initialize()
        self.daily_infections = []
        self.daily_viral_load_mean = []
        self.daily_rel_trans_mean = []
        self.timepoints = []

    def apply(self, sim):
        people = sim.people
        self.timepoints.append(sim.t)

        # è®°å½•æ¯æ—¥æ–°æ„ŸæŸ“æ•°
        self.daily_infections.append(people.flows.get('new_infections', 0))

        # è®°å½•ä¼ æŸ“è€…çš„å¹³å‡ç—…æ¯’è½½é‡å’Œä¼ æŸ“æ€§
        inf_inds = people.infectious.nonzero()[0]
        if len(inf_inds) > 0:
            self.daily_rel_trans_mean.append(people.rel_trans[inf_inds].mean())
        else:
            self.daily_rel_trans_mean.append(0)

tracker = TransmissionTracker()
sim = cv.Sim(pop_size=10000, n_days=90, verbose=0, analyzers=tracker)
sim.run()

# ç»˜åˆ¶ä¼ æ’­åŠ¨æ€
fig, axes = plt.subplots(2, 1, figsize=(10, 8))

axes[0].plot(tracker.timepoints, tracker.daily_infections)
axes[0].set_ylabel('æ¯æ—¥æ–°å¢æ„ŸæŸ“')
axes[0].set_title('æ¯æ—¥ä¼ æ’­åŠ¨æ€')
axes[0].grid(alpha=0.3)

axes[1].plot(tracker.timepoints, tracker.daily_rel_trans_mean)
axes[1].set_ylabel('å¹³å‡ç›¸å¯¹ä¼ æŸ“æ€§')
axes[1].set_xlabel('å¤©æ•°')
axes[1].grid(alpha=0.3)

plt.tight_layout()
plt.show()
```

---

## 11. å‚æ•°è¯¦è§£

### 11.1 åŸºç¡€ä¼ æ’­å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | å«ä¹‰ | æ¥æº/è¯´æ˜ |
|------|--------|------|-----------|
| `beta` | 0.016 | åŸºç¡€ä¼ æ’­ç‡ï¼ˆæ¯æ¬¡æœ‰ç—‡çŠ¶æ¥è§¦çš„ä¼ æ’­æ¦‚ç‡ï¼‰ | æ ¡å‡†å€¼ |
| `rel_beta` | 1.0 | å…¨å±€ç›¸å¯¹ä¼ æ’­ç‡å€æ•° | ç”¨æˆ·å¯è°ƒ |
| `asymp_factor` | 1.0 | æ— ç—‡çŠ¶ä¼ æ’­å› å­ï¼ˆä¹˜ä»¥betaï¼‰ | æ— ç»Ÿè®¡å­¦æ˜¾è‘—å·®å¼‚ |
| `n_imports` | 0 | æ¯æ—¥è¾“å…¥ç—…ä¾‹æ•°ï¼ˆæ³Šæ¾åˆ†å¸ƒï¼‰ | ç”¨æˆ·è®¾ç½® |
| `trans_redux` | 0.59 | çªç ´æ€§æ„ŸæŸ“ä¼ æŸ“æ€§é™ä½å› å­ | æ–‡çŒ®æ¥æº |

**ç§‘å­¦ä¾æ®**ï¼š
- `beta` æ ¡å‡†å€¼: é€šè¿‡æ‹ŸåˆçœŸå®ç–«æƒ…æ•°æ®æ ¡å‡†å¾—åˆ°
- `asymp_factor`: https://www.sciencedirect.com/science/article/pii/S1201971220302502
- `trans_redux`: https://www.medrxiv.org/content/10.1101/2021.07.13.21260393v

### 11.2 ä¸ªä½“ä¼ æŸ“æ€§åˆ†å¸ƒå‚æ•°ï¼ˆbeta_distï¼‰

| å‚æ•° | é»˜è®¤å€¼ | å«ä¹‰ |
|------|--------|------|
| `dist` | `'neg_binomial'` | åˆ†å¸ƒç±»å‹ï¼ˆè´ŸäºŒé¡¹åˆ†å¸ƒï¼‰ |
| `par1` | 1.0 | å‡å€¼ï¼ˆå¹³å‡ä¼ æŸ“æ€§ï¼‰ |
| `par2` | 0.45 | ç¦»æ•£å‚æ•°kï¼ˆè¶Šå°è¶Šåˆ†æ•£ï¼Œè¶…çº§ä¼ æ’­è€…è¶Šå¤šï¼‰ |
| `step` | 0.01 | æ­¥é•¿ï¼ˆç”¨äºäº§ç”Ÿéæ•´æ•°è¾“å‡ºï¼‰ |

**ç§‘å­¦ä¾æ®**ï¼š
- ç¦»æ•£å‚æ•°æ¥è‡ª https://www.researchsquare.com/article/rs-29548/v1
- COVID-19 ä¼ æ’­çš„é«˜åº¦å¼‚è´¨æ€§å·²è¢«å¹¿æ³›è®°å½•

**è´ŸäºŒé¡¹åˆ†å¸ƒå‚æ•°è§£è¯»**ï¼š
- **k = 0.1**ï¼šæåº¦åˆ†æ•£ï¼Œæå°‘æ•°äººè´¡çŒ®ç»å¤§éƒ¨åˆ†ä¼ æ’­ï¼ˆå¼ºè¶…çº§ä¼ æ’­è€…æ•ˆåº”ï¼‰
- **k = 0.45**ï¼šä¸­ç­‰åˆ†æ•£ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œè¾ƒå¥½åœ°åæ˜ COVID-19çš„ä¼ æ’­ç‰¹æ€§
- **k = 1.0**ï¼šä¸­åº¦åˆ†æ•£ï¼Œæ¥è¿‘å‡ ä½•åˆ†å¸ƒ
- **k â†’ âˆ**ï¼šé€€åŒ–ä¸ºæ³Šæ¾åˆ†å¸ƒï¼Œæ‰€æœ‰äººä¼ æ’­èƒ½åŠ›æ¥è¿‘

### 11.3 ç—…æ¯’è½½é‡å‚æ•°ï¼ˆviral_distï¼‰

| å‚æ•° | é»˜è®¤å€¼ | å«ä¹‰ |
|------|--------|------|
| `frac_time` | 0.3 | é«˜è½½é‡é˜¶æ®µå æ€»ä¼ æŸ“æœŸçš„æ¯”ä¾‹ï¼ˆ30%ï¼‰ |
| `load_ratio` | 2 | é«˜è½½é‡ä¸ä½è½½é‡çš„æ¯”å€¼ |
| `high_cap` | 4 | é«˜è½½é‡é˜¶æ®µçš„æœ€å¤§å¤©æ•°ä¸Šé™ |

**ç§‘å­¦ä¾æ®**ï¼š
- å‚æ•°ä¼°è®¡æ¥è‡ª Lescure 2020, Lancet, https://doi.org/10.1016/S1473-3099(20)30200-0

**ç—…æ¯’è½½é‡å‚æ•°æ•ˆæœè¯´æ˜**ï¼š
- `frac_time` è¶Šå¤§ï¼šé«˜è½½é‡é˜¶æ®µè¶Šé•¿ï¼Œå‰æœŸä¼ æŸ“æ€§æ›´é«˜
- `load_ratio` è¶Šå¤§ï¼šé«˜ä½è½½é‡å·®å¼‚è¶Šå¤§ï¼Œå‰æœŸä¼ æ’­æ›´é›†ä¸­
- `high_cap` è¶Šå¤§ï¼šå…è®¸æ›´é•¿çš„é«˜è½½é‡é˜¶æ®µï¼ˆä½†å— `frac_time` é™åˆ¶ï¼‰

### 11.4 æ¥è§¦å±‚å‚æ•°

| å‚æ•° | randomæ¨¡å¼ | hybridæ¨¡å¼ | è¯´æ˜ |
|------|-----------|-----------|------|
| `contacts['a']` | 20 | - | éšæœºç½‘ç»œçš„å¹³å‡æ¥è§¦æ•° |
| `contacts['h']` | - | 4 | å®¶åº­æ¥è§¦æ•° |
| `contacts['s']` | - | 20 | å­¦æ ¡æ¥è§¦æ•° |
| `contacts['w']` | - | 16 | å·¥ä½œæ¥è§¦æ•° |
| `contacts['c']` | - | 20 | ç¤¾åŒºæ¥è§¦æ•°ï¼ˆæ¯æ—¥åŠ¨æ€æ›´æ–°ï¼‰ |
| `beta_layer['a']` | 1.0 | - | éšæœºç½‘ç»œä¼ æ’­æƒé‡ |
| `beta_layer['h']` | - | 3.0 | å®¶åº­ä¼ æ’­æƒé‡ï¼ˆæœ€é«˜ï¼‰ |
| `beta_layer['s']` | - | 0.6 | å­¦æ ¡ä¼ æ’­æƒé‡ |
| `beta_layer['w']` | - | 0.6 | å·¥ä½œåœºæ‰€ä¼ æ’­æƒé‡ |
| `beta_layer['c']` | - | 0.3 | ç¤¾åŒºä¼ æ’­æƒé‡ï¼ˆæœ€ä½ï¼‰ |

### 11.5 éš”ç¦»å’Œæ£€ç–«å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | å«ä¹‰ |
|------|--------|------|
| `iso_factor` | `{'h':0.3, 's':0.0, 'w':0.0, 'c':0.1}` | è¯Šæ–­éš”ç¦»åå„å±‚ä¼ æ’­ç‡å€æ•° |
| `quar_factor` | `{'h':0.6, 's':0.0, 'w':0.0, 'c':0.2}` | æ£€ç–«éš”ç¦»åå„å±‚ä¼ æ’­ç‡å€æ•° |
| `quar_period` | 14 | éš”ç¦»å¤©æ•° |

> ğŸ’¡ **æ³¨æ„**ï¼š`iso_factor` å’Œ `quar_factor` åŒæ—¶å½±å“ä¼ æŸ“æ€§å’Œæ˜“æ„Ÿæ€§ä¸¤ä¸ªæ–¹å‘ã€‚

### 11.6 ç–¾ç—…è¿›å±•æ—¶é—´å‚æ•°

| è½¬æ¢ | åˆ†å¸ƒ | å‡å€¼ | æ ‡å‡†å·® | å‚æ•°å |
|------|------|------|--------|--------|
| æš´éœ²â†’ä¼ æŸ“ | å¯¹æ•°æ­£æ€ | 4.5å¤© | 1.5 | `dur_exp2inf` |
| ä¼ æŸ“â†’ç—‡çŠ¶ | å¯¹æ•°æ­£æ€ | 1.1å¤© | 0.9 | `dur_inf2sym` |
| ç—‡çŠ¶â†’é‡ç—‡ | å¯¹æ•°æ­£æ€ | 6.6å¤© | 4.9 | `dur_sym2sev` |
| é‡ç—‡â†’å±é‡ | å¯¹æ•°æ­£æ€ | 1.5å¤© | 2.0 | `dur_sev2crit` |
| æ— ç—‡çŠ¶åº·å¤ | å¯¹æ•°æ­£æ€ | 8.0å¤© | 2.0 | `dur_asym2rec` |
| è½»ç—‡åº·å¤ | å¯¹æ•°æ­£æ€ | 8.0å¤© | 2.0 | `dur_mild2rec` |
| é‡ç—‡åº·å¤ | å¯¹æ•°æ­£æ€ | 18.1å¤© | 6.3 | `dur_sev2rec` |
| å±é‡åº·å¤ | å¯¹æ•°æ­£æ€ | 18.1å¤© | 6.3 | `dur_crit2rec` |
| å±é‡æ­»äº¡ | å¯¹æ•°æ­£æ€ | 10.7å¤© | 4.8 | `dur_crit2die` |

### 11.7 å¹´é¾„ç›¸å…³é¢„åå‚æ•°

| å¹´é¾„ç»„ | sus_ORs | symp_probs | severe_probs | crit_probs | death_probs |
|--------|---------|------------|--------------|------------|-------------|
| 0-9 | 0.34 | 0.50 | 0.00050 | 0.00003 | 0.00002 |
| 10-19 | 0.67 | 0.55 | 0.00165 | 0.00008 | 0.00002 |
| 20-29 | 1.00 | 0.60 | 0.00720 | 0.00036 | 0.00010 |
| 30-39 | 1.00 | 0.65 | 0.02080 | 0.00104 | 0.00032 |
| 40-49 | 1.00 | 0.70 | 0.03430 | 0.00216 | 0.00098 |
| 50-59 | 1.00 | 0.75 | 0.07650 | 0.00933 | 0.00265 |
| 60-69 | 1.24 | 0.80 | 0.13280 | 0.03639 | 0.00766 |
| 70-79 | 1.47 | 0.85 | 0.20655 | 0.08923 | 0.02439 |
| 80-89 | 1.47 | 0.90 | 0.24570 | 0.17420 | 0.08292 |
| 90+ | 1.47 | 0.90 | 0.24570 | 0.17420 | 0.16190 |

> ğŸ’¡ **æ³¨æ„**ï¼šä¸Šè¡¨ä¸­ `severe_probs`ã€`crit_probs`ã€`death_probs` æ˜¯**ç»å¯¹æ¦‚ç‡**ã€‚Covasim å†…éƒ¨ä½¿ç”¨çš„æ˜¯**æ¡ä»¶æ¦‚ç‡**ï¼ˆé€šè¿‡ `relative_prognoses()` å‡½æ•°è½¬æ¢ï¼‰ã€‚

### 11.8 å˜ç§ä¼ æ’­å‚æ•°

| å˜ç§ | rel_beta | rel_symp_prob | rel_severe_prob | rel_crit_prob | rel_death_prob |
|------|----------|---------------|-----------------|---------------|----------------|
| Wildï¼ˆåŸå§‹æ ªï¼‰ | 1.0 | 1.0 | 1.0 | 1.0 | 1.0 |
| Alpha (B.1.1.7) | 1.67 | 1.0 | 1.64 | 1.0 | 1.0 |
| Beta (B.1.351) | 1.0 | 1.0 | 3.6 | 1.0 | 1.0 |
| Gamma (P.1) | 2.05 | 1.0 | 2.6 | 1.0 | 1.0 |
| Delta (B.1.617.2) | 2.2 | 1.0 | 3.2 | 1.0 | 1.0 |

### 11.9 åŒ»ç–—èµ„æºå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | å«ä¹‰ |
|------|--------|------|
| `n_beds_hosp` | None | åŒ»é™¢åºŠä½æ•°ï¼ˆNone=æ— é™åˆ¶ï¼‰ |
| `n_beds_icu` | None | ICUåºŠä½æ•°ï¼ˆNone=æ— é™åˆ¶ï¼‰ |
| `no_hosp_factor` | 2.0 | æ— åºŠä½æ—¶å±é‡æ¦‚ç‡å€å¢å› å­ |
| `no_icu_factor` | 2.0 | æ— ICUæ—¶æ­»äº¡æ¦‚ç‡å€å¢å› å­ |

---

## 12. å¸¸è§é—®é¢˜

### Q1: beta å€¼å¦‚ä½•å½±å“ä¼ æ’­ï¼Ÿ

`beta` æ˜¯æœ€æ ¸å¿ƒçš„ä¼ æ’­å‚æ•°ï¼Œç›´æ¥å†³å®šäº†æ¯æ¬¡æ¥è§¦çš„ä¼ æ’­æ¦‚ç‡ï¼š
- `beta = 0.016`ï¼ˆé»˜è®¤ï¼‰ï¼šé€‚åº¦ä¼ æ’­ï¼ŒR0 çº¦ 2-3
- `beta = 0.010`ï¼šè¾ƒä½ä¼ æ’­
- `beta = 0.025`ï¼šè¾ƒé«˜ä¼ æ’­

```python
# è°ƒæ•´beta
sim = cv.Sim(beta=0.020)  # å¢åŠ ä¼ æ’­ç‡

# ä¹Ÿå¯ä»¥é€šè¿‡å¹²é¢„æªæ–½åŠ¨æ€è°ƒæ•´
cb = cv.change_beta(days=30, changes=0.5)  # ç¬¬30å¤©å°†betaå‡åŠ
sim = cv.Sim(interventions=cb)
```

### Q2: ç—…æ¯’è½½é‡æ˜¯å®é™…çš„ç—…æ¯’æ‹·è´æ•°å—ï¼Ÿ

**ä¸æ˜¯**ã€‚Covasim ä¸­çš„ `viral_load` æ˜¯ä¸€ä¸ª**æ— é‡çº²çš„ç›¸å¯¹ä¼ æŸ“æ€§è°ƒèŠ‚å› å­**ï¼š
- å®ƒä¸ä»£è¡¨å®é™…çš„ç—…æ¯’æ‹·è´æ•°ï¼ˆå¦‚ PCR æ£€æµ‹çš„ CT å€¼ï¼‰
- å®ƒæ˜¯ä¸€ä¸ªæ—¶å˜çš„ä¹˜æ•°ï¼Œç”¨æ¥è°ƒèŠ‚ä¼ æŸ“è€…åœ¨ä¸åŒé˜¶æ®µçš„ä¼ æŸ“èƒ½åŠ›
- æ•´ä¸ªä¼ æŸ“æœŸçš„å¹³å‡è½½é‡è¢«å½’ä¸€åŒ–ä¸º 1.0
- é«˜è½½é‡é˜¶æ®µçº¦ä¸º 1.538ï¼Œä½è½½é‡é˜¶æ®µçº¦ä¸º 0.769ï¼ˆé»˜è®¤å‚æ•°ï¼‰

### Q3: ä¸ºä»€ä¹ˆæœ‰äº›äººä¼ æŸ“äº†å¾ˆå¤šäººï¼Œæœ‰äº›äººä¸€ä¸ªéƒ½æ²¡ä¼ æŸ“ï¼Ÿ

è¿™æ˜¯ç”±å¤šä¸ªå› ç´ å…±åŒé€ æˆçš„"è¶…çº§ä¼ æ’­è€…"ç°è±¡ï¼š

1. **ä¸ªä½“ä¼ æŸ“æ€§å¼‚è´¨æ€§**ï¼š`rel_trans` ä»è´ŸäºŒé¡¹åˆ†å¸ƒï¼ˆk=0.45ï¼‰ä¸­æŠ½å–ï¼Œå°‘æ•°äººä¼ æŸ“æ€§å¾ˆé«˜
2. **ç—…æ¯’è½½é‡æ—¶å˜**ï¼šæ„ŸæŸ“æ—©æœŸä¼ æŸ“æ€§æ›´é«˜
3. **æ¥è§¦ç½‘ç»œç»“æ„**ï¼šä¸åŒäººçš„æ¥è§¦æ•°é‡ä¸åŒ
4. **éšæœºæ€§**ï¼šæœ€ç»ˆä¼ æ’­æ˜¯ä¼¯åŠªåˆ©è¯•éªŒï¼Œæœ‰æ¦‚ç‡å› ç´ 

```python
# æŸ¥çœ‹ä¸ªä½“ä¼ æŸ“æ€§åˆ†å¸ƒ
sim.run()
people = sim.people
inf_inds = people.infectious.nonzero()[0]
print(f"ä¼ æŸ“è€…ä¼ æŸ“æ€§åˆ†å¸ƒ: mean={people.rel_trans[inf_inds].mean():.2f}, "
      f"std={people.rel_trans[inf_inds].std():.2f}, "
      f"max={people.rel_trans[inf_inds].max():.2f}")
```

### Q4: å¦‚ä½•ä¿®æ”¹ç‰¹å®šæ¥è§¦å±‚çš„ä¼ æ’­ç‡ï¼Ÿ

```python
# æ–¹æ³•1: åœ¨åˆ›å»ºæ¨¡æ‹Ÿæ—¶è®¾ç½®
sim = cv.Sim(
    pop_type='hybrid',
    beta_layer={'h': 3.0, 's': 0.6, 'w': 0.6, 'c': 0.3}
)

# æ–¹æ³•2: ä½¿ç”¨ change_beta å¹²é¢„æªæ–½ï¼ˆæŒ‰å±‚è°ƒæ•´ï¼‰
cb = cv.change_beta(days=30, changes={'h': 1.0, 's': 0.0, 'w': 0.5, 'c': 0.2})
sim = cv.Sim(pop_type='hybrid', interventions=cb)

# æ–¹æ³•3: åœ¨åˆå§‹åŒ–åç›´æ¥ä¿®æ”¹
sim.initialize()
sim.people.contacts['c']['beta'] *= 0.5  # ç¤¾åŒºä¼ æ’­å‡åŠ
```

### Q5: çªç ´æ€§æ„ŸæŸ“çš„ä¼ æŸ“æ€§é™ä½åªå‘ç”Ÿä¸€æ¬¡å—ï¼Ÿ

**æ˜¯çš„**ã€‚åªæœ‰ç¬¬ä¸€æ¬¡çªç ´æ€§æ„ŸæŸ“æ—¶æ‰ä¼šé™ä½ä¼ æŸ“æ€§ï¼š

```python
# people.py ç¬¬488-491è¡Œ
no_prior_breakthrough = (self.n_breakthroughs[breakthrough_inds] == 0)
new_breakthrough_inds = breakthrough_inds[no_prior_breakthrough]
self.rel_trans[new_breakthrough_inds] *= self.pars['trans_redux']  # åªå¯¹é¦–æ¬¡çªç ´
```

è¿™æ„å‘³ç€ï¼š
- ç¬¬ä¸€æ¬¡çªç ´æ€§æ„ŸæŸ“ï¼š`rel_trans Ã— 0.59`
- ç¬¬äºŒæ¬¡åŠä»¥åçš„çªç ´æ€§æ„ŸæŸ“ï¼šä¸å†é¢å¤–é™ä½
- `trans_redux` çš„å€¼ï¼ˆ0.59ï¼‰æ˜¯æ°¸ä¹…æ€§åœ°ä¹˜åˆ° `rel_trans` ä¸Šçš„

### Q6: æ„ŸæŸ“åçš„é¢„åæ˜¯ä»€ä¹ˆæ—¶å€™å†³å®šçš„ï¼Ÿ

**åœ¨æ„ŸæŸ“å‘ç”Ÿçš„é‚£ä¸€åˆ»å°±å…¨éƒ¨å†³å®šäº†ï¼** `infect()` å‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶ï¼š

1. ç«‹å³ç¡®å®šæ˜¯å¦å‡ºç°ç—‡çŠ¶ï¼ˆä¼¯åŠªåˆ©è¯•éªŒï¼‰
2. å¦‚æœæœ‰ç—‡çŠ¶ï¼Œç«‹å³ç¡®å®šæ˜¯å¦é‡ç—‡
3. å¦‚æœé‡ç—‡ï¼Œç«‹å³ç¡®å®šæ˜¯å¦å±é‡
4. å¦‚æœå±é‡ï¼Œç«‹å³ç¡®å®šæ˜¯å¦æ­»äº¡
5. æ‰€æœ‰è½¬æ¢çš„æ—¶é—´ç‚¹ä¹Ÿåœ¨æ­¤æ—¶ä»å¯¹æ•°æ­£æ€åˆ†å¸ƒä¸­æŠ½å–

è¿™æ„å‘³ç€æ¯ä¸ªäººçš„æ•´ä¸ªç–¾ç—…æ—¶é—´çº¿åœ¨æ„ŸæŸ“ç¬é—´å°±å·²ç»ç¡®å®šäº†ï¼Œåç»­çš„ `check_*()` å‡½æ•°åªæ˜¯åœ¨æ­£ç¡®çš„æ—¶é—´è§¦å‘è¿™äº›é¢„å®šçš„è½¬æ¢ã€‚

### Q7: å¦‚ä½•æŸ¥çœ‹ä¼ æ’­æ—¥å¿—ï¼Ÿ

```python
# è¿è¡Œæ¨¡æ‹Ÿ
sim = cv.Sim(pop_size=1000, pop_infected=1, n_days=30, verbose=0)
sim.run()

# æŸ¥çœ‹ä¼ æ’­æ—¥å¿—ï¼ˆæ¯æ¡è®°å½•åŒ…å«ï¼šæºã€ç›®æ ‡ã€æ—¥æœŸã€å±‚ã€å˜ç§ï¼‰
for entry in sim.people.infection_log[:20]:
    src = entry['source']
    tgt = entry['target']
    day = entry['date']
    layer = entry['layer']
    var = entry['variant']
    print(f"Day {day}: {src} â†’ {tgt} (Layer: {layer}, Variant: {var})")

# æŸ¥çœ‹ç‰¹å®šä¸ªä½“çš„å®Œæ•´æ•…äº‹
sim.people.story(0)

# ä½¿ç”¨ TransTree åˆ†æå™¨è¿›è¡Œæ›´è¯¦ç»†çš„ä¼ æ’­æ ‘åˆ†æ
tt = cv.TransTree(sim)
print(f"ä¼ æ’­æ ‘ä¸­å…±æœ‰ {len(tt.infection_log)} æ¡ä¼ æ’­è®°å½•")
```

---

## 13. æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

**1. ä½¿ç”¨ hybrid äººå£ç±»å‹è·å¾—æ›´çœŸå®çš„ä¼ æ’­æ¨¡å¼**

```python
sim = cv.Sim(pop_type='hybrid')  # åŒ…å«å®¶åº­ã€å­¦æ ¡ã€å·¥ä½œã€ç¤¾åŒºå±‚
```

**2. æ ¹æ®ç ”ç©¶ç›®æ ‡æ ¡å‡† beta å€¼**

```python
# ä½¿ç”¨ Calibration å·¥å…·
calib = cv.Calibration(sim, calib_pars={'beta': [0.010, 0.025]}, ...)
```

**3. è€ƒè™‘è¶…çº§ä¼ æ’­è€…æ•ˆåº”**

```python
# é»˜è®¤çš„ beta_dist å·²ç»åŒ…å«äº†è¶…çº§ä¼ æ’­è€…æ•ˆåº”
# å¦‚æœéœ€è¦æ›´å¼ºçš„æ•ˆåº”ï¼Œå‡å° k å€¼
sim = cv.Sim(beta_dist=dict(dist='neg_binomial', par1=1.0, par2=0.2, step=0.01))
```

**4. ä½¿ç”¨å¤šå˜ç§æ¨¡æ‹Ÿæ—¶æ³¨æ„äº¤å‰å…ç–«**

```python
variants = [
    cv.variant('alpha', days=30),
    cv.variant('delta', days=90),
]
sim = cv.Sim(variants=variants, use_waning=True)
```

**5. åˆ†æä¼ æ’­é“¾ä»¥ç†è§£ä¼ æ’­åŠ¨æ€**

```python
sim.run()
for entry in sim.people.infection_log:
    # åˆ†æä¼ æ’­æ¥æºã€å±‚ã€æ—¶é—´ç­‰
    pass
```

### âŒ é¿å…çš„åšæ³•

**1. ä¸è¦å¿½ç•¥æ¥è§¦ç½‘ç»œç»“æ„å¯¹ä¼ æ’­çš„å½±å“**

```python
# âŒ åªå…³æ³¨ beta è€Œå¿½ç•¥ beta_layer å’Œ contacts
# âœ… åŒæ—¶è°ƒæ•´ betaã€beta_layer å’Œæ¥è§¦æ•°é‡
```

**2. ä¸è¦å°† viral_load ç†è§£ä¸ºçœŸå®çš„ç—…æ¯’æ‹·è´æ•°**

```python
# âŒ å°† viral_load ä¸ PCR CT å€¼ç›´æ¥å¯¹åº”
# âœ… å°†å…¶ç†è§£ä¸ºæ—¶å˜çš„ç›¸å¯¹ä¼ æŸ“æ€§è°ƒèŠ‚å› å­
```

**3. ä¸è¦åœ¨å¤šå˜ç§æ¨¡æ‹Ÿä¸­å¿½ç•¥å…ç–«è¡°å‡**

```python
# âŒ å¤šå˜ç§æ¨¡æ‹Ÿæ—¶ use_waning=False
# âœ… å¤šå˜ç§æ¨¡æ‹Ÿæ—¶ use_waning=Trueï¼Œæ­£ç¡®è®¾ç½®äº¤å‰å…ç–«
```

**4. ä¸è¦å‡è®¾æ‰€æœ‰äººçš„ä¼ æŸ“æ€§ç›¸åŒ**

```python
# âŒ beta_dist è®¾ä¸ºå¸¸æ•°
# âœ… ä½¿ç”¨è´ŸäºŒé¡¹åˆ†å¸ƒåæ˜ ä¼ æ’­å¼‚è´¨æ€§
```

---

## 14. æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **åŸºäºä¸ªä½“çš„ä¼ æ’­æ¨¡å‹**
   - æ¯å¯¹æ¥è§¦ç‹¬ç«‹è®¡ç®—ä¼ æ’­æ¦‚ç‡
   - ä¼ æ’­æ¦‚ç‡ = Î² Ã— ä¼ æŸ“æ€§å› å­ Ã— æ˜“æ„Ÿæ€§å› å­ Ã— æ¥è§¦æƒé‡
   - æœ€ç»ˆé€šè¿‡ä¼¯åŠªåˆ©è¯•éªŒå†³å®šæ˜¯å¦æ„ŸæŸ“

2. **ä¸ªä½“ä¼ æŸ“æ€§ï¼ˆrel_transï¼‰**
   - åˆå§‹å€¼ = å¹´é¾„å› å­ Ã— è´ŸäºŒé¡¹åˆ†å¸ƒæŠ½æ ·
   - è´ŸäºŒé¡¹åˆ†å¸ƒï¼ˆk=0.45ï¼‰äº§ç”Ÿè¶…çº§ä¼ æ’­è€…æ•ˆåº”
   - çªç ´æ€§æ„ŸæŸ“æ—¶ä¹˜ä»¥ 0.59 é™ä½ä¼ æŸ“æ€§

3. **ç—…æ¯’è½½é‡ï¼ˆviral_loadï¼‰æ˜¯æ—¶å˜ä¼ æŸ“æ€§è°ƒèŠ‚å› å­**
   - ä¸æ˜¯çœŸå®çš„ç—…æ¯’æ‹·è´æ•°ï¼Œè€Œæ˜¯ç›¸å¯¹ä¼ æŸ“æ€§ä¹˜æ•°
   - åˆ†ä¸ºé«˜è½½é‡é˜¶æ®µï¼ˆå‰30%æ—¶é—´ï¼Œä¼ æŸ“æ€§çº¦1.538ï¼‰å’Œä½è½½é‡é˜¶æ®µï¼ˆå70%æ—¶é—´ï¼Œä¼ æŸ“æ€§çº¦0.769ï¼‰
   - é«˜è½½é‡é˜¶æ®µæœ€å¤š4å¤©ï¼ˆ`high_cap` é™åˆ¶ï¼‰
   - æ•´ä¸ªä¼ æŸ“æœŸå¹³å‡è½½é‡å½’ä¸€åŒ–ä¸º1.0

4. **å¤šå› å­ç»¼åˆå†³å®šä¼ æ’­**
   - ä¼ æŸ“æºä¾§ï¼š`rel_trans Ã— æ„ŸæŸ“çŠ¶æ€ Ã— ç—…æ¯’è½½é‡ Ã— ç—‡çŠ¶å› å­ Ã— éš”ç¦»å› å­`
   - ç›®æ ‡ä¾§ï¼š`rel_sus Ã— æ˜“æ„ŸçŠ¶æ€ Ã— éš”ç¦»å› å­ Ã— (1-å…ç–«ä¿æŠ¤)`
   - å…¨å±€ä¾§ï¼š`Î² Ã— å˜ç§ä¼ æ’­ç‡ Ã— æ¥è§¦å±‚æƒé‡`

5. **æ„ŸæŸ“åé¢„ååœ¨æ„ŸæŸ“ç¬é—´ç¡®å®š**
   - æ‰€æœ‰åˆ†æ”¯ï¼ˆç—‡çŠ¶/é‡ç—‡/å±é‡/æ­»äº¡ï¼‰å’Œæ—¶é—´çº¿åœ¨æ„ŸæŸ“æ—¶ä¸€æ¬¡æ€§å†³å®š
   - å—å¹´é¾„ã€å˜ç§ã€å…ç–«çŠ¶æ€ã€åŒ»ç–—èµ„æºç­‰å½±å“

### å…³é”®å‡½æ•°é€ŸæŸ¥è¡¨

| å‡½æ•° | ä½ç½® | ç”¨é€” |
|------|------|------|
| `compute_viral_load()` | `utils.py` | è®¡ç®—æ—¶å˜ç—…æ¯’è½½é‡ |
| `compute_trans_sus()` | `utils.py` | è®¡ç®—æœ‰æ•ˆä¼ æŸ“æ€§å’Œæ˜“æ„Ÿæ€§ |
| `compute_infections()` | `utils.py` | ç¡®å®šè°æ„ŸæŸ“äº†è°ï¼ˆæ ¸å¿ƒä¼ æ’­è®¡ç®—ï¼‰ |
| `infect()` | `people.py` | æ‰§è¡Œæ„ŸæŸ“ã€ç¡®å®šå®Œæ•´é¢„å |
| `set_prognoses()` | `people.py` | åˆå§‹åŒ–ä¸ªä½“ä¼ æŸ“æ€§å’Œæ˜“æ„Ÿæ€§ |
| `check_immunity()` | `immunity.py` | è®¡ç®—å…ç–«ä¿æŠ¤å› å­ |
| `update_states_pre()` | `people.py` | æ¯æ—¥çŠ¶æ€æ›´æ–°ï¼ˆä¼ æ’­å‰ï¼‰ |
| `step()` | `sim.py` | æ¯æ—¥æ¨¡æ‹Ÿä¸»å¾ªç¯ |

### ä¼ æ’­å…¬å¼æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¼ æ’­æ¦‚ç‡å®Œæ•´å…¬å¼                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  P(iâ†’j) = Î² Ã— rel_beta Ã— rel_beta_variant                  â”‚
â”‚           Ã— rel_trans(i) Ã— inf(i) Ã— viral_load(i)          â”‚
â”‚           Ã— f_asymp(i) Ã— f_iso(i) Ã— f_quar(i)             â”‚
â”‚           Ã— beta_layer                                      â”‚
â”‚           Ã— rel_sus(j) Ã— sus(j) Ã— f_quar(j)               â”‚
â”‚           Ã— (1 - sus_imm(j))                                â”‚
â”‚           Ã— layer_beta(i,j)                                 â”‚
â”‚                                                             â”‚
â”‚  ç„¶å: if random() < P(iâ†’j) â†’ å‘ç”Ÿæ„ŸæŸ“                      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 15. å‚è€ƒèµ„æº

### ç§‘å­¦æ–‡çŒ®

1. **ä¸ªä½“ä¼ æ’­å¼‚è´¨æ€§ï¼ˆè¶…çº§ä¼ æ’­è€…ï¼‰**:
   - https://www.researchsquare.com/article/rs-29548/v1
   - è´ŸäºŒé¡¹åˆ†å¸ƒç¦»æ•£å‚æ•°çš„æ¥æº

2. **ç—…æ¯’è½½é‡æ—¶é—´åŠ¨æ€**:
   - Lescure et al. (2020), Lancet: https://doi.org/10.1016/S1473-3099(20)30200-0
   - `viral_dist` å‚æ•°çš„æ¥æº

3. **æ— ç—‡çŠ¶ä¼ æ’­**:
   - https://www.sciencedirect.com/science/article/pii/S1201971220302502
   - æ— ç—‡çŠ¶ä¼ æ’­ä¸æœ‰ç—‡çŠ¶ä¼ æ’­æ— ç»Ÿè®¡å­¦æ˜¾è‘—å·®å¼‚

4. **çªç ´æ€§æ„ŸæŸ“ä¼ æŸ“æ€§é™ä½**:
   - https://www.medrxiv.org/content/10.1101/2021.07.13.21260393v
   - `trans_redux = 0.59` çš„æ¥æº

5. **å¹´é¾„ç›¸å…³æ˜“æ„Ÿæ€§**:
   - Zhang et al., Science: https://science.sciencemag.org/content/early/2020/05/04/science.abb8001
   - `sus_ORs` å‚æ•°çš„æ¥æº

6. **NAbä¸å…ç–«ä¿æŠ¤**:
   - Khoury et al. (2021): https://www.nature.com/articles/s41591-021-01377-8
   - å…ç–«ä¿æŠ¤å› å­çš„è½¬æ¢æ¨¡å‹

7. **å˜ç§ä¼ æ’­å‚æ•°**:
   - Alpha: https://science.sciencemag.org/content/372/6538/eabg3055
   - Gamma: https://science.sciencemag.org/content/early/2021/04/13/science.abh2644
   - Delta: https://www.researchsquare.com/article/rs-637724/v1

### Covasim æºä»£ç 

- **ä¼ æ’­æ ¸å¿ƒ**: `covasim/utils.py`ï¼ˆ`compute_viral_load`, `compute_trans_sus`, `compute_infections`ï¼‰
- **æ„ŸæŸ“å¤„ç†**: `covasim/people.py`ï¼ˆ`infect`, `set_prognoses`ï¼‰
- **æ¨¡æ‹Ÿä¸»å¾ªç¯**: `covasim/sim.py`ï¼ˆ`step`ï¼‰
- **å…ç–«è®¡ç®—**: `covasim/immunity.py`ï¼ˆ`check_immunity`, `calc_VE`ï¼‰
- **å‚æ•°å®šä¹‰**: `covasim/parameters.py`ï¼ˆ`make_pars`, `get_prognoses`, `get_variant_pars`ï¼‰
- **é»˜è®¤å€¼**: `covasim/defaults.py`ï¼ˆ`PeopleMeta`ï¼‰
- **æ¥è§¦ç½‘ç»œ**: `covasim/base.py`ï¼ˆ`Layer`, `Contacts`ï¼‰
- **äººå£ç”Ÿæˆ**: `covasim/population.py`ï¼ˆ`make_randpop`, `make_hybrid_contacts`ï¼‰

### å…³é”®å‚æ•°ä½ç½®

- **ä¼ æ’­å‚æ•°**: `covasim/parameters.py` ä¸­çš„ `make_pars()`ï¼ˆ`beta`, `beta_dist`, `viral_dist`, `asymp_factor`ï¼‰
- **æ¥è§¦å±‚å‚æ•°**: `covasim/parameters.py` ä¸­çš„ `reset_layer_pars()`
- **é¢„åå‚æ•°**: `covasim/parameters.py` ä¸­çš„ `get_prognoses()`
- **å˜ç§å‚æ•°**: `covasim/parameters.py` ä¸­çš„ `get_variant_pars()`
- **äº¤å‰å…ç–«**: `covasim/parameters.py` ä¸­çš„ `get_cross_immunity()`

---

> å¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£ Covasim çš„ç—…æ¯’ä¼ æ’­æœºåˆ¶ï¼ ğŸ¦ ğŸ“¡
> å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿æŸ¥çœ‹æºä»£ç æˆ–è¿è¡Œç¤ºä¾‹ï¼